var mode="n";text=function(phrase){mode||(mode="n");var string={n:{empty:"-"," 1st":"1番"," 2nd":"2番"," 3rd":"3番"," 4th":"4番"," 5th":"5番"," 6th":"6番"," 7th":"7番"," 8th":"8番"," 9th":"9番","Now batting":"次のバッタ、","way outside":"相当外角",outside:"外角",inside:"内角","way inside":"相当内角","way low":"相当低め",low:"低め",high:"高め","way high":"相当高め","down the middle":"真ん中","first baseman":"ファースト","second baseman":"セカンド","third baseman":"サード",shortstop:"ショート",pitcher:"ピッチャー",catcher:"キャッチャー","left fielder":"レフト","center fielder":"センター","right fielder":"ライト","Strike.":"ストライク。","Ball.":"ボール。","Fouled off.":"ファウル。","In play.":"インプレー。","Swinging strike.":"空振り。","4-seam":"ストレイト","2-seam":"シュート",slider:"スライダー",fork:"フォーク",cutter:"カット",sinker:"シンカー",curve:"カーブ",change:"チェンジ"," struck out looking.":"、見逃し三振。"," walked.":"、フォアボール。"," struck out swinging.":"、空振り三振。","Previous: ":"前：","looks like: ":"予想","breaking ball":"変化球",fastball:"ストレート","Batting, ":"打球","Catching, pitch selection":"捕球選択",Season:"記録",Game:"今試合",Pitch:"球",Control:"制球",Velocity:"速度",Break:"変化","At Bat :":"バッタ","On Deck :":"次バッタ","Eye :":"目","Power :":"力","Speed :":"速","Up to Bat":"打席",Fielding:"守備",BA:"打率",OBP:"出塁",OPS:"出長",PA:"打席","H/2B/3B/HR":"安／二／三／本",H:"安","2B":"二","3B":"三",HR:"本塁打",RBI:"打点",R:"得点",BB:"四球",SO:"三振","Select Language:":"言語","Run Fast Simulation":"シミュレーションを試合終了まで行う","Play Ball!":"プレーボール","Spectate the CPU":"CPU観戦",LHP:"左投",RHP:"右投",LHB:"左打",RHB:"右打",L:"左","R ":"右","#":"背番号"},e:{empty:"-",Season:"Career"}}[mode][phrase];return string?string:phrase},text.fielderShortName=function(fielder){return"n"==mode?{first:"一",second:"二",third:"三","short":"遊",pitcher:"投",catcher:"捕",left:"左",center:"中",right:"右"}[fielder]:fielder},text.slash=function(){return"n"==mode?"・":"/"},text.fielderLongName=function(fielder){return"n"==mode?{first:"ファースト",second:"セカンド",third:"サード","short":"ショート",pitcher:"ピッチャー",catcher:"キャッチャー",left:"レフト",center:"センター",right:"ライト"}[fielder]:{first:text("first baseman"),second:text("second baseman"),third:text("third baseman"),"short":text("shortstop"),pitcher:text("pitcher"),catcher:text("catcher"),left:text("left fielder"),center:text("center fielder"),right:text("right fielder")}[fielder]},text.comma=function(){return{n:"、",e:", "}[mode]},text.stop=function(){return{n:"。",e:". "}[mode]},text.namePitch=function(pitch){return"e"==mode?pitch.name.charAt(0).toUpperCase()+pitch.name.slice(1):"n"==mode?text(pitch.name):void 0},text.contactResult=function(batter,fielder,bases,outBy){var statement="",infield=["left","center","right"].indexOf(fielder)<0;if("e"==mode){if(statement+=batter,outBy)switch(outBy){case"error":statement+=" reached on error by "+text.fielderShortName(fielder);break;case"pop":statement+=" popped out to "+text.fielderShortName(fielder);break;case"fly":statement+=" flew out to "+text.fielderShortName(fielder);break;case"ground":statement+=" grounded out to "+text.fielderShortName(fielder);break;case"thrown":statement+=" was thrown out by "+text.fielderShortName(fielder)}else switch(bases){case 1:statement+=infield?" reached on an infield hit to "+text.fielderShortName(fielder):" reached on a single to "+text.fielderShortName(fielder);break;case 2:statement+=" doubled past "+text.fielderShortName(fielder);break;case 3:statement+=" tripled past "+text.fielderShortName(fielder);break;case 4:statement+=" homered to "+text.fielderShortName(fielder)}statement+=text.stop()}if("n"==mode){if(statement+=batter+"は",outBy)switch(fielder=text.fielderShortName(fielder),outBy){case"error":statement+="エラー("+fielder+")で出塁";break;case"pop":statement+="ポップフライで"+fielder+"飛";break;case"fly":statement+=fielder+"飛";break;case"ground":statement+=fielder+"ゴロ";break;case"thrown":statement+=fielder+"ゴロ"}else switch(fielder=text.fielderLongName(fielder),bases){case 1:statement+=infield?"内野安打("+fielder+")で出塁":"安打("+fielder+")で出塁";break;case 2:statement+="二塁打（"+fielder+"）で出塁";break;case 3:statement+="三塁打（"+fielder+"）で出塁";break;case 4:statement+="本塁打（"+fielder+"）"}statement+=text.stop()}return statement},data={surnames:["Sato","Suzuki","Takahashi","Tanaka","Watanabe","Ito","Nakamura","Kobayashi","Yamamoto","Kato","Yoshida","Yamada","Sasaki","Yamaguchi","Matsumoto","Inoue","Kimura","Shimizu","Hayashi","Saito","Saito","Yamazaki","Nakajima","Mori","Abe","Ikeda","Hashimoto","Ishikawa","Yamashita","Ogawa","Ishii","Hasegawa","Goto","Okada","Kondo","Maeda","Fujita","Endo","Aoki","Sakamoto","Murakami","Ota","Kaneko","Fujii","Fukuda","Nishimura","Miura","Takeuchi","Nakagawa","Okamoto","Matsuda","Harada","Nakano"],surnamesJ:["佐藤","鈴木","高橋","田中","渡辺","伊藤","中村","小林","山本","加藤","吉田","山田","佐々木","山口","松本","井上","木村","清水","林","斉藤","斎藤","山崎","中島","森","阿部","池田","橋本","石川","山下","小川","石井","長谷川","後藤","岡田","近藤","前田","藤田","遠藤","青木","坂本","村上","太田","金子","藤井","福田","西村","三浦","竹内","中川","岡本","松田","原田","中野"],namesJ:["匠","ヒカル","ゆうき","翔太","冬馬","漣","港区","ルイ","樹","賢治","五木","春","光一","宗介","こうすけ","雄太","大樹","瑛太","宏","亨","道夫","聡","昭","茂雄","勝","純一","和夫","勲","省三","隆","達夫","正一","輝夫","俊夫","史郎","勇","義弘","良雄","登","義明","正義","秀夫","肇","月","克己","正男","光男","久","耕三","清","次郎","正博","明子","武","勉","晴夫","裕二","稔","障子","和子","敦","茂","信夫","恵一","忠","高尾","薫","ケン","健治","哲夫","啓二","光一","真一","貞夫","靖","武","雄","文雄","久雄","一朗","健一","正明","五郎","誠","昭夫","誠司","洋一","康夫","誠一","正美","則夫","幸雄","忠雄","仁","シンジ","豊","邦雄","修","雅之","三郎","英治","浩二","栄一","恒夫","義郎","進","博之","巌"],names:["Takumi","Hikaru","Yuuki","Shouta","Touma","Ren","Minato","Rui","Tatsuki","Kenji","Itsuki","Haru","Kouichi","Sousuke","Kousuke","Yuuta","Daiki","Eita","Hiroshi","Toru","Michio","Satoshi","Akira","Shigeo","Masaru","Junichi","Kazuo","Isao","Shozo","Takashi","Tatsuo","Shoichi","Teruo","Toshio","Shiro","Isamu","Yoshihiro","Yoshio","Noboru","Yoshiaki","Tadayoshi","Hideo","Hajime","Akari","Katsumi","Masao","Mitsuo","Hisashi","Kozo","Kiyoshi","Jiro","Masahiro","Akiko","Takeshi","Tsutomu","Haruo","Yuji","Minoru","Shoji","Kazuko","Atsushi","Shigeru","Shinobu","Keiichi","Tadashi","Takao","Kaoru","Ken","Kenji","Tetsuo","Keiji","Koichi","Shinichi","Sadao","Yasushi","Takeshi","Yu","Fumio","Hisao","Ichiro","Kenichi","Masaaki","Goro","Makoto","Akio","Seiji","Yoichi","Yasuo","Seiichi","Masami","Norio","Yukio","Tadao","Hitoshi","Shinji","Yutaka","Kunio","Osamu","Masayuki","Saburo","Eiji","Koji","Eiichi","Tsuneo","Yoshio","Susumu","Hiroyuki","Iwao"],teamNamesJ:["横浜","大阪","名古屋","札幌","神戸","京都","福岡","川崎","埼玉県","広島","仙台","千葉県","新潟","浜松","静岡","相模原","岡山","熊本","鹿児島","船橋","川口","姫路","松山","宇都宮","松戸","西宮","倉敷","市川","福山","尼崎","金沢","長崎","横須賀","富山","高松","町田","岐阜","枚方","藤沢","柏","豊中","長野県","豊橋","一宮","和歌山","岡崎","宮崎","奈良","吹田","高槻","旭川","いわき","高崎","所沢","川越","秋田","越谷","前橋","那覇","四日市","青森","久留米","春日井","盛岡","明石","福島","下関","長岡","市原","函館","茨城県","福井","加古川","徳島","水戸","平塚","佐世保","呉","八戸","佐賀","寝屋川","富士","春日部","茅ヶ崎","松本","厚木","大和","上尾","宝塚","筑波","沼津","熊谷","伊勢崎","岸和田","鳥取","小田原","鈴鹿","松江","日立"],teamNames:["Yokohama","Osaka","Nagoya","Sapporo","Kobe","Kyoto","Fukuoka","Kawasaki","Saitama","Hiroshima","Sendai","Chiba","Niigata","Hamamatsu","Shizuoka","Sagamihara","Okayama","Kumamoto","Kagoshima","Funabashi","Kawaguchi","Himeji","Matsuyama","Utsunomiya","Matsudo","Nishinomiya","Kurashiki","Ichikawa","Fukuyama","Amagasaki","Kanazawa","Nagasaki","Yokosuka","Toyama","Takamatsu","Machida","Gifu","Hirakata","Fujisawa","Kashiwa","Toyonaka","Nagano","Toyohashi","Ichinomiya","Wakayama","Okazaki","Miyazaki","Nara","Suita","Takatsuki","Asahikawa","Iwaki","Takasaki","Tokorozawa","Kawagoe","Akita","Koshigaya","Maebashi","Naha","Yokkaichi","Aomori","Kurume","Kasugai","Morioka","Akashi","Fukushima","Shimonoseki","Nagaoka","Ichihara","Hakodate","Ibaraki","Fukui","Kakogawa","Tokushima","Mito","Hiratsuka","Sasebo","Kure","Hachinohe","Saga","Neyagawa","Fuji","Kasukabe","Chigasaki","Matsumoto","Atsugi","Yamato","Ageo","Takarazuka","Tsukuba","Numazu","Kumagaya","Isesaki","Kishiwada","Tottori","Odawara","Suzuka","Matsue","Hitachi"]},helper={pitchDefinitions:{"4-seam":[0,0,1],"2-seam":[20,-20,.9],cutter:[-25,-20,.95],sinker:[-15,-30,.95],slider:[-50,-35,.9],fork:[0,-70,.87],curve:[0,-90,.82],change:[0,-10,.88]},selectRandomPitch:function(){return["4-seam","2-seam","cutter","sinker","slider","fork","curve","change"][Math.floor(8*Math.random())]}};var Log=function(){this.init()};Log.prototype={game:"instance of Game",init:function(){this.pitchRecord={e:[],n:[]}},SINGLE:"H",DOUBLE:"2B",TRIPLE:"3B",HOMERUN:"HR",WALK:"BB",GROUNDOUT:"GO",FLYOUT:"FO",LINEOUT:"L",RUN:"R",STRIKEOUT:"SO",SACRIFICE:"SAC",REACHED_ON_ERROR:"ROE",FIELDERS_CHOICE:"FC",note:function(note,noteJ){this.record.e.unshift(note),this.shortRecord.e=this.record.e.slice(0,6),this.record.n.unshift(noteJ),this.shortRecord.n=this.record.n.slice(0,6)},getBatter:function(batter){var order=batter.team.nowBatting;order={0:text(" 1st"),1:text(" 2nd"),2:text(" 3rd"),3:text(" 4th"),4:text(" 5th"),5:text(" 6th"),6:text(" 7th"),7:text(" 8th"),8:text(" 9th")}[order];var positions=this.longFormFielder();return text("Now batting")+order+text.comma()+positions[batter.position]+text.comma()+batter.getUniformNumber()+text.comma()+batter.getName()},noteBatter:function(batter){var record,recordJ,m=mode;mode="e",record=this.getBatter(batter),mode="n",recordJ=this.getBatter(batter),mode=m,this.note(record,recordJ)},getPitchLocationDescription:function(pitchInFlight,batterIsLefty){var x=pitchInFlight.x,y=pitchInFlight.y,say="",noComma=!1,noComma2=!1,ball=!1;return batterIsLefty||(x=200-x),50>x?(say+=text("way outside"),ball=!0):70>x?say+=text("outside"):100>x?(say+="",noComma=!0):130>x?(say+="",noComma=!0):150>x?say+=text("inside"):(say+=text("way inside"),ball=!0),""!=say&&(say+=text.comma()),35>y?(say+=text("way low"),ball=!0):65>y?say+=text("low"):135>y?(say+="",noComma2=!0):165>y?say+=text("high"):(say+=text("way high"),ball=!0),(noComma||noComma2)&&(say=say.split(text.comma()).join(""),noComma&&noComma2&&(say=text("down the middle"))),say=text.namePitch(pitchInFlight)+text.comma()+say+text.stop()},notePitch:function(pitchInFlight,batter){var record,recordJ,m=mode;mode="e",record=this.getPitchLocationDescription(pitchInFlight,"left"==batter.bats),this.pitchRecord.e.unshift(record),mode="n",recordJ=this.getPitchLocationDescription(pitchInFlight,"left"==batter.bats),this.pitchRecord.n.unshift(recordJ),mode=m},getSwing:function(swingResult){var result="";return result+=text(swingResult.looking?swingResult.strike?"Strike.":"Ball.":swingResult.contact?swingResult.foul?"Fouled off.":swingResult.caught?"In play.":swingResult.thrownOut?"In play.":"In play.":"Swinging strike.")},noteSwing:function(swingResult){var record,recordJ,m=mode;mode="e",record=this.getSwing(swingResult),this.pitchRecord.e[0]+=record,mode="n",recordJ=this.getSwing(swingResult),this.pitchRecord.n[0]+=recordJ,mode=m},getPlateAppearanceResult:function(game){var r=game.swingResult,record="",batter=game.batter.getName();if(r.looking)record=r.strike?batter+text(" struck out looking."):batter+text(" walked.");else if(r.contact){var outBy,fielder=r.fielder,bases=r.bases;if(r.caught)outBy=["left","center","right"].indexOf(r.fielder)<0?"pop":"fly";else if(r.foul);else if(r.error)bases=1,outBy="error";else if(r.thrownOut)outBy=Math.random()>.5?"ground":"thrown";else switch(r.bases){case 1:case 2:case 3:bases=r.bases;break;case 4:bases=4,fielder=r.splay<-15?"left":r.splay<15?"center":"right"}record=text.contactResult(batter,fielder,bases,outBy)}else record=batter+text(" struck out swinging.");return record},notePlateAppearanceResult:function(game){var record,recordJ,m=mode;mode="e",record=this.getPlateAppearanceResult(game),this.record.e.unshift(record),this.pitchRecord.e=[text("Previous: ")+record],mode="n",recordJ=this.getPlateAppearanceResult(game),this.record.n.unshift(recordJ),this.pitchRecord.n=[text("Previous: ")+recordJ],mode=m},pointer:0,pitchRecord:{e:[],n:[]},shortRecord:{e:[],n:[]},record:{e:[],n:[]},longFormFielder:function(){return{first:text("first baseman"),second:text("second baseman"),third:text("third baseman"),"short":text("shortstop"),pitcher:text("pitcher"),catcher:text("catcher"),left:text("left fielder"),center:text("center fielder"),right:text("right fielder")}}};var Animator=function(){this.init(),Math.square=function(x){return x*x}};Animator.prototype={name:"Animator",constructor:Animator,init:function(){},pitchTarget:null,pitchBreak:null,updateFlightPath:function(callback){var $scope=this,game=$scope.y,top=200-game.pitchTarget.y,left=game.pitchTarget.x,breakTop=200-game.pitchInFlight.y,breakLeft=game.pitchInFlight.x,$baseballs=jQ(".baseball"),flightSpeed=1.3-.6*(game.pitchInFlight.velocity+300)/400,originTop=50,originLeft=110+("left"==game.pitcher["throws"]?20:-20);this.pitchTarget=jQ(".main-area .target .baseball.pitch"),this.pitchBreak=jQ(".main-area .target .baseball.break");var pitch=this.pitchTarget,henka=this.pitchBreak,quarter=flightSpeed/4,transition=function(percent,top,left,step){left=originLeft+Math.square(percent/100)*(left-originLeft),top=originTop+Math.square(percent/100)*(top-originTop);var padding=Math.max(13*Math.square(percent/100),1),borderWidth=Math.max(4*Math.square(percent/100),1);return{top:top,left:left,padding:padding+"px",borderWidth:borderWidth+"px",transform:"translateZ(0)",delay:quarter*step,ease:Linear.easeNone}},transitions=[transition(0,top,left,0),transition(10,top,left,0),transition(30,top,left,1),transition(50,top,left,2),transition(100,top,left,3),transition(100,breakTop,breakLeft,3)],horizontalBreak=(60-Math.abs(game.pitchTarget.x-game.pitchInFlight.x))/10;jQ(".baseball").addClass("spin"),jQ(".baseball").css("animation","spin "+horizontalBreak+"s 5 0s linear"),TweenMax.set([pitch,henka],transitions[0]),TweenMax.to([pitch,henka],quarter,transitions[1]),TweenMax.to([pitch,henka],quarter,transitions[2]),TweenMax.to([pitch,henka],quarter,transitions[3]),TweenMax.to(pitch,quarter,transitions[4]),TweenMax.to(henka,quarter,transitions[5]),$scope.lastTimeout=setTimeout(function(){$scope.allowInput=!0,"function"==typeof callback&&(callback(),$scope.$apply())},1e3*flightSpeed),game.pitchInFlight.x?(game.humanBatting()&&100*Math.random()>game.batter.skill.offense.eye?jQ(".baseball.break").addClass("hide"):jQ(".baseball.break").removeClass("hide"),jQ(".baseball.pitch").removeClass("hide")):$baseballs.addClass("hide"),$scope.y.humanBatting()&&!$scope.y.humanPitching()&&$scope.holdUpTimeouts.push(setTimeout(function(){$scope.holdUp()},1e3*(flightSpeed+1.2)))}};var AtBat=function(text){this.infield=text.indexOf(AtBat.prototype.INFIELD_HIT_INDICATOR)>-1?AtBat.prototype.INFIELD_HIT_INDICATOR:"",text=text.replace(AtBat.prototype.INFIELD_HIT_INDICATOR,""),this.text=text.split(AtBat.prototype.RBI_INDICATOR)[0],this.rbi=text.split(this.text)[1]+"";var log=new Log,beneficial=[log.WALK,log.SINGLE,log.HOMERUN,log.DOUBLE,log.TRIPLE,log.SACRIFICE,log.REACHED_ON_ERROR];beneficial.indexOf(this.text)>-1&&(this.beneficial=!0)};AtBat.prototype.toString=function(){return""+this.infield+this.text+this.rbi},AtBat.prototype.constructor=AtBat,AtBat.prototype.identifier="AtBat",AtBat.prototype.INFIELD_HIT_INDICATOR="",AtBat.prototype.RBI_INDICATOR="+";var Field=function(game){this.init(game)};Field.prototype={constructor:Field,init:function(game){this.game=game,this.first=null,this.second=null,this.third=null},hasRunnersOn:function(){return this.first instanceof Player||this.second instanceof Player||this.third instanceof Player},translateSwingResultToStylePosition:function(swingResult){var bottom=0,left=190;return bottom=Math.cos(swingResult.splay/180*Math.PI)*swingResult.travelDistance*95/300,left=Math.sin(swingResult.splay/180*Math.PI)*swingResult.travelDistance*95/300+190,bottom=Math.max(Math.min(bottom,400),-20),left=Math.max(Math.min(left,280),100),swingResult.bottom=bottom+"px",swingResult.left=left+"px",swingResult},determineSwingContactResult:function(swing){"undefined"==typeof swing&&(swing=this);var x=swing.x,y=swing.y,splayAngle=90-1.5*x,flyAngle=-3*y,power=this.game.batter.skill.offense.power+this.game.batter.eye.bonus,landingDistance=(50+300*Math.random()+power/100*75)*(1-Math.abs(flyAngle-30)/60);Math.abs(90-splayAngle)>50&&(swing.foul=!0),swing.fielder=this.findFielder(splayAngle,landingDistance),swing.travelDistance=landingDistance,swing.flyAngle=flyAngle,swing.splay=splayAngle-90,this.game.debug||(this.game.debug=[]);var debugData={},dd=debugData;if(swing.fielder){var fielder=this.game.half==top?this.game.teams.home.positions[swing.fielder]:this.game.teams.away.positions[swing.fielder];fielder.fatigue+=4,swing.error=!1;var fieldingEase=fielder.skill.defense.fielding/100,throwingEase=fielder.skill.defense.throwing/100;swing.fielderTravel=this.getPolarDistance(this.positions[swing.fielder],[splayAngle,landingDistance]);var interceptRating=fielder.skill.defense.speed+flyAngle-1.65*swing.fielderTravel;if(interceptRating>0&&flyAngle>-10?.4*(100-fielder.skill.defense.fielding)+4>100*Math.random()?(fieldingEase*=.5,swing.error=!0,swing.caught=!1):swing.caught=!0:swing.caught=!1,dd.caught=swing.caught,dd.grounder=0>flyAngle,!swing.caught){var plus=interceptRating+100*throwingEase*fieldingEase,gatherAndThrowSuccess=plus-this.game.batter.skill.offense.speed/2>-50;if(dd.thrownOut=gatherAndThrowSuccess,dd.outFielder=1=={left:1,center:1,right:1}[swing.fielder],1!={left:1,center:1,right:1}[swing.fielder]&&gatherAndThrowSuccess)swing.thrownOut=!0,swing.error=!1;else if(swing.thrownOut=!1,swing.bases=1,1=={left:1,center:1,right:1}[swing.fielder]){var fieldingReturnDelay=-1*(interceptRating+100*throwingEase*fieldingEase)+this.game.batter.skill.offense.speed;for(dd.delay=fieldingReturnDelay;fieldingReturnDelay-125>0&&swing.bases<3;)swing.bases++,fieldingReturnDelay-=65;dd.bases=swing.bases}}}else Math.abs(90-splayAngle)<45&&landingDistance>300?(swing.bases=4,dd.bases=4):(swing.foul=!0,swing.caught=!1);return dd.foul=swing.foul,this.game.debug.push(dd),this.translateSwingResultToStylePosition(swing)},findFielder:function(splayAngle,landingDistance){return Math.abs(90-splayAngle)>50?!1:10>landingDistance&&landingDistance>-20?"catcher":landingDistance>=10&&66>landingDistance&&Math.abs(90-splayAngle)<5?"pitcher":landingDistance>20&&landingDistance+Math.abs(90-splayAngle)/90*37<155?68>splayAngle?"third":91>splayAngle?"short":114>splayAngle?"second":"first":landingDistance>90&&310>landingDistance?73>splayAngle?"left":107>splayAngle?"center":"right":!1},positions:{pitcher:[90,66],catcher:[0,0],first:[128,98],second:[102.5,130],"short":[77.5,130],third:[52,98],left:[59,280],center:[90,280],right:[121,280]},getPolarDistance:function(a,b){return Math.sqrt(a[1]*a[1]+b[1]*b[1]-2*a[1]*b[1]*Math.cos(a[0]*Math.PI/180-b[0]*Math.PI/180))},fieldingTest:function(){var angle=90*Math.random()+45,distance=320*Math.random(),fielder=this.findFielder(angle,distance),data={};if(fielder){var fielderCandidates=this.fielderSelectionTest(angle,distance,!0);return data.fielder=fielderCandidates[1],data[fielderCandidates[0]]=this.getPolarDistance([angle,distance],[this.positions[fielderCandidates[0]][0],this.positions[fielderCandidates[0]][1]]),data[fielderCandidates[1]]=this.getPolarDistance([angle,distance],[this.positions[fielderCandidates[1]][0],this.positions[fielderCandidates[1]][1]]),data}},aggregateFieldingTest:function(){for(var fielders={pitcher:{tally:0,distances:[]},catcher:{tally:0,distances:[]},first:{tally:0,distances:[]},second:{tally:0,distances:[]},"short":{tally:0,distances:[]},third:{tally:0,distances:[]},left:{tally:0,distances:[]},center:{tally:0,distances:[]},right:{tally:0,distances:[]},"false":{tally:0,distances:[]}},selections=[],i=0;1e3>i;i++){var angle=90*Math.random()+45,distance=320*Math.random(),fielder=this.findFielder(angle,distance);fielders[fielder].tally++,fielder&&fielders[fielder].distances.push(this.getPolarDistance([angle,distance],[this.positions[fielder][0],this.positions[fielder][1]])),selections.push([angle,distance]),selections.push(this.fielderSelectionTest(angle,distance,!0))}return[fielders,selections]},fielderSelectionTest:function(angle,distance,returnFielder){var distances=[],minDistance=300,giraffe=this,fielder=!1;return jQ.each(this.positions,function(position,spot){var thisDistance=giraffe.getPolarDistance([angle,distance],spot);distances[thisDistance]=position,minDistance>thisDistance&&(minDistance=thisDistance,fielder=position)}),returnFielder?[fielder,this.findFielder(angle,distance)]:distances}};var Game=function(m){this.init(m)};Game.prototype={constructor:Game,gamesIntoSeason:0,humanControl:"none",quickMode:!0,init:function(m){for(m&&(window.mode=m),this.gamesIntoSeason=60+Math.floor(20*Math.random()),this.field=new Field(this),this.teams.away=new Team(this),this.teams.home=new Team(this),this.log=new Log,this.log.game=this,this.helper=helper;this.teams.away.name==this.teams.home.name;)this.teams.away.pickName();this.umpire=new Umpire(this),this.humanPitching()&&(this.stage="pitch")},getInning:function(){return"n"==mode?this.inning+("top"==this.half?"オモテ":"ウラ"):this.half.toUpperCase()+" "+this.inning},humanBatting:function(){if("none"==this.humanControl)return!1;switch(this.half){case"top":return"both"==this.humanControl||"away"==this.humanControl;case"bottom":return"both"==this.humanControl||"home"==this.humanControl}},humanPitching:function(){if("none"==this.humanControl)return!1;switch(this.half){case"top":return"both"==this.humanControl||"home"==this.humanControl;case"bottom":return"both"==this.humanControl||"away"==this.humanControl}},end:function(){this.stage="end";var e,n;e=this.tally.home.R>this.tally.away.R?"Home team wins!":this.tally.home.R==this.tally.away.R?"You tied. Yes, you can do that.":"Visitors win!",n=this.tally.home.R>this.tally.away.R?"Home team wins!":this.tally.home.R==this.tally.away.R?"You tied. Yes, you can do that.":"Visitors win!",this.log.note(e,n)},stage:"pitch",simulateInput:function(callback){"end"!=this.stage&&("pitch"==this.stage?this.autoPitch(callback):"swing"==this.stage&&("object"!=typeof this.pitchTarget&&(this.pitchTarget={x:100,y:100}),this.autoSwing(this.pitchTarget.x,this.pitchTarget.y,callback)))},simulatePitchAndSwing:function(callback){if("end"!=this.stage){this.autoPitch(callback);var giraffe=this;setTimeout(function(){"object"!=typeof giraffe.pitchTarget&&(giraffe.pitchTarget={x:100,y:100}),giraffe.autoSwing(giraffe.pitchTarget.x,giraffe.pitchTarget.y,function(callback){callback()})},giraffe.field.hasRunnersOn()?2400:3900)}},receiveInput:function(x,y,callback){"none"!=this.humanControl&&"end"!=this.stage&&("pitch"==this.stage&&this.humanPitching()?this.thePitch(x,y,callback):"swing"==this.stage&&this.humanBatting()&&this.theSwing(x,y,callback))},autoPitchSelect:function(){for(var pitchName=this.helper.selectRandomPitch();!this.pitcher.pitching.hasOwnProperty(pitchName);)pitchName=this.helper.selectRandomPitch();var pitch=this.pitcher.pitching[pitchName];pitch.name=pitchName,this.pitchInFlight=pitch},autoPitch:function(callback){var pitcher=this.pitcher;if("pitch"==this.stage){jQ(".baseball").addClass("hide"),pitcher.windingUp=!0,this.swingResult.looking=!0;var windup=jQ(".windup");windup.css("width","100%");var giraffe=this;if(this.autoPitchSelect(),Math.random()<.5)var x=50+Math.floor(70*Math.random())-Math.floor(15*Math.random());else x=150+Math.floor(15*Math.random())-Math.floor(70*Math.random());var y=30+(170-Math.floor(Math.sqrt(28900*Math.random())));this.quickMode?giraffe.thePitch(x,y,callback):windup.animate({width:0},this.field.hasRunnersOn()?1500:3e3,function(){jQ(".baseball.pitch").removeClass("hide"),giraffe.thePitch(x,y,callback),pitcher.windingUp=!1})}},autoSwing:function(deceptiveX,deceptiveY,callback){var giraffe=this,bonus=this.batter.eye.bonus||0,eye=this.batter.skill.offense.eye+6*(this.umpire.count.balls+this.umpire.count.strikes)+bonus,x=100+Math.floor(15*Math.random())-Math.floor(15*Math.random()),y=100+Math.floor(15*Math.random())-Math.floor(15*Math.random());if(100*Math.random()<eye){var convergence=6.75*eye/100,convergenceSum=1+convergence;deceptiveX=this.pitchInFlight.x,deceptiveY=this.pitchInFlight.y}else convergence=2.7*eye/100,convergenceSum=1+convergence;x=(deceptiveX*convergence+x)/convergenceSum,y=(deceptiveY*convergence+y)/convergenceSum;var swingLikelihood=(200-Math.abs(100-x)-Math.abs(100-y))/2;swingLikelihood=60>x||x>140||50>y||y>150?Math.min(swingLikelihood,100-eye)-15*this.umpire.count.balls:Math.max(45,(2*swingLikelihood+eye)/3);var chance=100*Math.random(),totalLikelihood=swingLikelihood-35+10*(this.umpire.count.balls+2*this.umpire.count.strikes);chance>totalLikelihood&&(x=-20),callback(function(){giraffe.theSwing(x,y)})},thePitch:function(x,y,callback){if("pitch"==this.stage){this.pitcher.fatigue++,this.pitchTarget.x=x,this.pitchTarget.y=y,this.pitchInFlight.breakDirection=this.helper.pitchDefinitions[this.pitchInFlight.name].slice(0,2),this.battersEye=text("looks like: ")+text(Math.abs(this.pitchInFlight.breakDirection[0])+Math.abs(this.pitchInFlight.breakDirection[1])>40?"breaking ball":"fastball");var control=this.pitchInFlight.control;this.pitchTarget.x=Math.min(199.9,Math.max(.1,this.pitchTarget.x+(50-100*Math.random())/(1+control/100))),this.pitchTarget.y=Math.min(199.9,Math.max(.1,this.pitchTarget.y+(50-100*Math.random())/(1+control/100))),"right"==this.pitcher["throws"]&&(this.pitchInFlight.breakDirection[0]*=-1),this.pitchInFlight.x=Math.floor(this.pitchTarget.x+this.pitchInFlight.breakDirection[0]*((.5+Math.random()*this.pitchInFlight["break"])/100)),this.pitchInFlight.y=Math.floor(this.pitchTarget.y+this.pitchInFlight.breakDirection[1]*((.5+Math.random()*this.pitchInFlight["break"])/100)/(.5+this.pitchTarget.y/200)),this.log.notePitch(this.pitchInFlight,this.batter),this.stage="swing","none"==this.humanControl||"both"!=this.humanControl&&this.teams[this.humanControl]!=this.batter.team?this.autoSwing(x,y,callback):callback()}},battersEye:"",debugOut:function(){log("grounders",this.debug.filter(function(a){return!a.caught&&!a.foul&&a.grounder}).length),log("grounders thrown out",this.debug.filter(function(a){return!a.caught&&!a.foul&&a.grounder&&a.thrownOut}).length),log("weak outfield hits",this.debug.filter(function(a){return!a.caught&&!a.foul&&!a.grounder&&a.thrownOut}).length),log("good outfield hits",this.debug.filter(function(a){return!(a.caught||a.foul||a.grounder||a.thrownOut)}).length),log("singles",this.debug.filter(function(a){return 1==a.bases}).length),log("2b",this.debug.filter(function(a){return 2==a.bases}).length),log("3b",this.debug.filter(function(a){return 3==a.bases}).length),log("homeruns",this.debug.filter(function(a){return 4==a.bases}).length),log("fly outs",this.debug.filter(function(a){return!a.grounder&&!a.bases&&a.caught}).length),log("groundouts",this.debug.filter(function(a){return a.grounder&&!a.bases&&!a.caught}).length);var SO=this.teams.away.lineup.map(function(p){return p.atBats}).reduce(function(a,b){return a+b.filter(function(ab){return"SO"==ab}).length});SO+=this.teams.home.lineup.map(function(p){return p.atBats.filter(function(ab){return"SO"==ab})}).reduce(function(a,b){return a.length+b.length}),log("strikeouts",this.debug.filter(function(a){return a.grounder&&!a.bases&&!a.caught}).length),log("fouls",this.debug.filter(function(a){return a.foul}).length)},theSwing:function(x,y,callback){if("swing"==this.stage){this.batter.fatigue++,this.swingResult={};var bonus=this.batter.eye.bonus||0,eye=this.batter.skill.offense.eye+6*(this.umpire.count.balls+this.umpire.count.strikes)+bonus;this.swingResult.x=100+(x-100)*(.5+Math.random()*eye/200)-this.pitchInFlight.x,this.swingResult.y=100+(y-100)*(.5+Math.random()*eye/200)-this.pitchInFlight.y,0>x||x>200?(this.swingResult.strike=this.pitchInFlight.x>50&&this.pitchInFlight.x<150&&this.pitchInFlight.y>35&&this.pitchInFlight.y<165,this.swingResult.contact=!1,this.swingResult.looking=!0,this.batter.eye.x=this.pitchInFlight.x,this.batter.eye.y=this.pitchInFlight.y):(this.swingResult.looking=!1,Math.abs(this.swingResult.x)<60&&Math.abs(this.swingResult.y)<35?(this.swingResult.contact=!0,this.batter.eye.bonus=Math.max(0,eye-1.5*Math.sqrt(Math.pow(this.batter.eye.x-this.pitchInFlight.x,2)+Math.pow(this.batter.eye.y-this.pitchInFlight.y,2))),this.swingResult=this.field.determineSwingContactResult(this.swingResult)):this.swingResult.contact=!1),this.log.noteSwing(this.swingResult),this.stage="pitch";var half=this.half;this.umpire.makeCall(),half!=this.half&&(callback=this.startOpponentPitching),"function"==typeof callback&&("none"==this.humanControl||"both"!=this.humanControl&&this.teams[this.humanControl]!=this.pitcher.team?this.autoPitch(callback):callback())}},startOpponentPitching:null,pitchTarget:{x:100,y:100},pitchInFlight:{x:100,y:100,breakDirection:[0,0],name:"slider",velocity:50,"break":50,control:50},swingResult:{x:100,y:100,strike:!1,foul:!1,caught:!1,contact:!1,looking:!0,bases:0,fielder:"short",outs:0},pitchSelect:function(){},field:null,teams:{away:null,home:null},log:null,half:"top",inning:1,scoreboard:{away:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},home:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0}},tally:{away:{H:0,R:0,E:0},home:{H:0,R:0,E:0}}};var Manager=function(team){this.init(team)};Manager.prototype={constructor:Manager,init:function(team){this.team=team},makeLineup:function(){var jerseyNumber=1;this.team.positions.pitcher=this.selectForSkill(this.team.bench,["pitching"]),this.team.positions.pitcher.position="pitcher",this.team.positions.pitcher.number=jerseyNumber++,this.team.positions.catcher=this.selectForSkill(this.team.bench,["defense","catching"],!0),this.team.positions.catcher.position="catcher",this.team.positions.catcher.number=jerseyNumber++,jQ.each(this.team.bench,function(key,player){player.number=jerseyNumber++}),this.team.positions["short"]=this.selectForSkill(this.team.bench,["defense","fielding"],!0),this.team.positions["short"].position="short",this.team.positions.second=this.selectForSkill(this.team.bench,["defense","fielding"],!0),this.team.positions.second.position="second",this.team.positions.third=this.selectForSkill(this.team.bench,["defense","fielding"],!0),this.team.positions.third.position="third",this.team.positions.center=this.selectForSkill(this.team.bench,["defense","speed"]),this.team.positions.center.position="center",this.team.positions.left=this.selectForSkill(this.team.bench,["defense","speed"]),this.team.positions.left.position="left",this.team.positions.right=this.selectForSkill(this.team.bench,["defense","speed"]),this.team.positions.right.position="right",this.team.positions.first=this.selectForSkill(this.team.bench,["defense","fielding"]),this.team.positions.first.position="first",this.team.lineup[3]=this.selectForSkill(this.team.positions,["offense","power"]),this.team.lineup[3].order=3,this.team.lineup[2]=this.selectForSkill(this.team.positions,["offense","power"]),this.team.lineup[2].order=2,this.team.lineup[4]=this.selectForSkill(this.team.positions,["offense","power"]),this.team.lineup[4].order=4,this.team.lineup[0]=this.selectForSkill(this.team.positions,["offense","speed"]),this.team.lineup[0].order=0,this.team.lineup[1]=this.selectForSkill(this.team.positions,["offense","eye"]),this.team.lineup[1].order=1,this.team.lineup[5]=this.selectForSkill(this.team.positions,["offense","eye"]),this.team.lineup[5].order=5,this.team.lineup[6]=this.selectForSkill(this.team.positions,["offense","eye"]),this.team.lineup[6].order=6,this.team.lineup[7]=this.selectForSkill(this.team.positions,["offense","eye"]),this.team.lineup[7].order=7,this.team.lineup[8]=this.selectForSkill(this.team.positions,["offense","speed"]),this.team.lineup[8].order=8},selectForSkill:function(pool,skillset,mustBeRightHanded){var property;if(mustBeRightHanded=!!mustBeRightHanded,this.team.bench.length||pool==this.team.positions){var selection=this.team.bench[0],rating=0,index=0;return jQ.each(pool,function(key,player){for(var skills=skillset.slice(),cursor=player.skill;property=skills.shift();)cursor=cursor[property];player.order+1||!(cursor>=rating)||mustBeRightHanded&&"right"!=player["throws"]||(rating=cursor,selection=player,index=key)}),delete this.team.bench[index],pool==this.team.bench&&(this.team.bench=this.team.bench.filter(function(player){
return player instanceof selection.constructor})),selection}return"no players available"}};var Player=function(team){this.init(team);var IP,ER,GS,W,L,offense=this.skill.offense,defense=this.skill.defense,randBetween=function(a,b,skill){return offense[skill]&&(skill=offense[skill]),defense[skill]&&(skill=defense[skill]),isNaN(skill)&&(skill=50),skill=Math.sqrt(.05+.95*Math.random())*skill,Math.floor(skill/100*(b-a)+a)},gamesIntoSeason=this.team.game.gamesIntoSeason;this.skill.pitching>65&&(IP=(this.skill.pitching-65)*gamesIntoSeason/20,ER=IP/9*randBetween(800,215,this.skill.pitching)/100,IP>gamesIntoSeason?(GS=Math.floor(gamesIntoSeason/5),W=randBetween(.1*GS,.8*GS,this.skill.pitching/1.2),L=randBetween(GS-W,0,this.skill.pitching/3)):(GS=Math.floor(gamesIntoSeason/40),W=randBetween(0,.6*GS,this.skill.pitching),L=randBetween(GS-W,0,this.skill.pitching)));var pa=randBetween(3*gamesIntoSeason,5*gamesIntoSeason,"speed"),paRemaining=pa,bb=Math.floor(randBetween(0,18,"power")*paRemaining/100);paRemaining-=bb;var ab=paRemaining,so=Math.floor(randBetween(33,2,"eye")*paRemaining/100);paRemaining-=so;var h=Math.floor(randBetween(185,472,"eye")*paRemaining/1e3);paRemaining-=h;var doubles=randBetween(0,h/3,"power"),triples=randBetween(0,h/12,"speed"),hr=Math.max(0,randBetween(-h/5,h/5,"power")),r=randBetween(h/8,(h+bb)/3,"speed")+hr,rbi=randBetween(h/8,h/2,"power")+hr,hbp=randBetween(0,gamesIntoSeason/25),sf=randBetween(0,gamesIntoSeason/5,"eye"),chances=randBetween(0,10*gamesIntoSeason,"fielding"),E=randBetween(chances/10,0,"fielding"),PO=chances-E;this.stats={pitching:{pitches:0,GS:GS,W:W,L:L,strikes:0,K:0,getERA:function(){return 9*this.ER/Math.max(1/3,this.IP[0]+this.IP[1]/3)},ERA:null,ER:ER,H:0,HR:0,BB:0,IP:[IP,0]},batting:{getBA:function(){return this.h/Math.max(1,this.ab)},ba:null,getOBP:function(){return(h+bb+hbp)/(ab+bb+hbp+sf)},obp:null,getSLG:function(){return(h-doubles-triples-hr+2*doubles+3*triples+4*hr)/ab},slg:null,pa:pa,ab:ab,so:so,bb:bb,h:h,"2b":doubles,"3b":triples,hr:hr,r:r,rbi:rbi,hbp:hbp},fielding:{E:E,PO:PO,A:Math.floor(5*Math.random())+1}},this.stats.pitching.ERA=this.stats.pitching.getERA(),this.stats.batting.ba=this.stats.batting.getBA()};Player.prototype={constructor:Player,init:function(team){this["throws"]=Math.random()>.86?"left":"right",this.bats=Math.random()>.75?"left":"right",this.team=team,this.skill={},this.eye={x:100,y:100},this.pitching={averaging:[]},this.number=0,this.randomizeSkills(Math.random()>.9);var surnameKey=Math.floor(Math.random()*data.surnames.length),nameKey=Math.floor(Math.random()*data.names.length);this.name=data.surnames[surnameKey]+" "+data.names[nameKey];var jSurname=data.surnamesJ[surnameKey],jGivenName=data.namesJ[nameKey];1==jSurname.length&&jGivenName.length<=2&&(jSurname+="・"),1==jGivenName.length&&jSurname.indexOf("・")<0&&(jSurname+="・"),this.nameJ=jSurname+jGivenName,this.surname=data.surnames[surnameKey],this.surnameJ=data.surnamesJ[surnameKey],this.atBats=[]},atBatObjects:[],getAtBats:function(){return this.atBats.length>this.atBatObjects.length&&(this.atBatObjects=this.atBats.map(function(item){return new AtBat(item)})),this.atBatObjects},recordRBI:function(){this.atBats[this.atBats.length-1]+=AtBat.prototype.RBI_INDICATOR},recordInfieldHit:function(){this.atBats[this.atBats.length-1]+=AtBat.prototype.INFIELD_HIT_INDICATOR},randomizeSkills:function(hero){this.hero=hero;var giraffe=this,randValue=function(isPitching){var value=Math.floor(80*Math.pow(Math.random(),.75)+20*Math.random());return hero&&(value+=Math.floor((100-value)*Math.max(Math.random(),isPitching?0:.65))),isPitching&&giraffe.pitching.averaging.push(value),value};this.skill.offense={eye:randValue(),power:randValue(),speed:randValue()},this.skill.defense={catching:randValue(),fielding:randValue(),speed:randValue(),throwing:randValue()},this.pitching.averaging=[],this.pitching["4-seam"]={velocity:randValue(!0),"break":randValue(!0),control:randValue(!0)},this.pitching.slider={velocity:randValue(!0),"break":randValue(!0),control:randValue(!0)},Math.random()<.17&&(Math.random()>.6&&(this.pitching["2-seam"]={velocity:randValue(!0),"break":randValue(!0),control:randValue(!0)}),Math.random()<.18&&(this.pitching.fork={velocity:randValue(!0),"break":randValue(!0),control:randValue(!0)}),Math.random()>.77&&(this.pitching.cutter={velocity:randValue(!0),"break":randValue(!0),control:randValue(!0)}),Math.random()<.21&&(this.pitching.sinker={velocity:randValue(!0),"break":randValue(!0),control:randValue(!0)}),Math.random()<.4&&(this.pitching.curve={velocity:randValue(!0),"break":randValue(!0),control:randValue(!0)}),Math.random()<.9&&(this.pitching.change={velocity:randValue(!0),"break":randValue(!0),control:randValue(!0)})),this.skill.pitching=Math.floor(this.pitching.averaging.reduce(function(prev,current,index,arr){return prev+current})/this.pitching.averaging.length+3*this.pitching.averaging.length),delete this.pitching.averaging},getSurname:function(){return"n"==mode?this.surnameJ:this.surname},getName:function(){return"n"==mode?this.nameJ:this.name},getUniformNumber:function(){return text("#")+this.number},getOrder:function(){return text([" 1st"," 2nd"," 3rd"," 4th"," 5th"," 6th","7th"," 8th"," 9th"][this.order])},eye:{},fatigue:0,name:"",number:0,position:"",atBats:[]};var Team=function(game){this.init(game)};Team.prototype={constructor:Team,init:function(game){this.lineup=[],this.bench=[],this.bullpen=[],this.positions={pitcher:null,catcher:null,first:null,second:null,"short":null,third:null,left:null,center:null,right:null},this.game=game;for(var j=0;20>j;j++)this.bench.push(new Player(this));this.manager=new Manager(this),this.manager.makeLineup(),this.pickName()},pickName:function(){var teamNameIndex=Math.floor(Math.random()*data.teamNames.length);this.name=data.teamNames[teamNameIndex],this.nameJ=data.teamNamesJ[teamNameIndex]},getName:function(){return"n"==mode?this.nameJ:this.name},lineup:[],positions:{},manager:null,bench:[],bullpen:[],nowBatting:0,expanded:"Player&"};var Umpire=function(game){this.init(game)};Umpire.prototype={constructor:Umpire,init:function(game){this.game=game,this.playBall()},count:{strikes:0,balls:0,outs:0},playBall:function(){this.game.half="top",this.game.inning=1,this.game.batter=this.game.teams.away.lineup[0],this.game.deck=this.game.teams.away.lineup[1],this.game.hole=this.game.teams.away.lineup[2],this.game.pitcher=this.game.teams.home.positions.pitcher;var n="一回のオモテ、"+this.game.teams.away.getName()+"の攻撃対"+this.game.teams.home.getName()+"、ピッチャーは"+this.game.teams.home.positions.pitcher.getName()+"。",e="Top 1, "+this.game.teams.away.name+" offense vs. "+this.game.teams.home.positions.pitcher.name+" starting for "+this.game.teams.home.name;this.game.log.note(e,n),this.game.log.noteBatter(this.game.batter)},makeCall:function(){this.says="";var result=this.game.swingResult,pitcher=this.game.pitcher,batter=this.game.batter;if(pitcher.stats.pitching.pitches++,result.looking)result.strike?(this.count.strikes++,pitcher.stats.pitching.strikes++):this.count.balls++;else if(result.contact){if(result.caught)this.count.outs++,pitcher.stats.pitching.IP[1]++,this.game.batter.atBats.push(Log.prototype.FLYOUT),batter.stats.batting.pa++,batter.stats.batting.ab++,this.newBatter();else if(result.foul)this.count.strikes++,pitcher.stats.pitching.strikes++,this.count.strikes>2&&(this.count.strikes=2);else if(batter.stats.batting.pa++,batter.stats.batting.ab++,result.thrownOut&&(this.count.outs++,pitcher.stats.pitching.IP[1]++,this.game.batter.atBats.push(Log.prototype.GROUNDOUT),this.newBatter()),result.bases){result.error?result.bases>0&&(this.game.tally["top"==this.game.half?"home":"away"].E++,this.game.teams["top"==this.game.half?"home":"away"].positions[result.fielder].stats.fielding.E++):(this.game.tally["top"==this.game.half?"away":"home"][Log.prototype.SINGLE]++,pitcher.stats.pitching.H++);var bases=result.bases;switch(bases){case 0:this.game.batter.atBats.push(Log.prototype.GROUNDOUT);break;case 1:result.error?this.game.batter.atBats.push(Log.prototype.REACHED_ON_ERROR):(this.game.batter.atBats.push(Log.prototype.SINGLE),batter.stats.batting.h++);break;case 2:this.game.batter.atBats.push(Log.prototype.DOUBLE),batter.stats.batting.h++,batter.stats.batting["2b"]++;break;case 3:this.game.batter.atBats.push(Log.prototype.TRIPLE),batter.stats.batting.h++,batter.stats.batting["3b"]++;break;case 4:this.game.batter.atBats.push(Log.prototype.HOMERUN),pitcher.stats.pitching.HR++,batter.stats.batting.h++,batter.stats.batting.hr++}bases>0&&4>bases&&!result.error&&-1==["left","right","center"].indexOf(result.fielder)&&batter.recordInfieldHit();for(var onBase=!1;bases>0;)bases-=1,this.advanceRunners(),onBase||(this.reachBase(),onBase=!0);this.newBatter()}}else pitcher.stats.pitching.strikes++,this.count.strikes++;this.says=this.count.balls+" and "+this.count.strikes,this.count.strikes>2&&(batter.stats.batting.pa++,batter.stats.batting.ab++,batter.stats.batting.so++,pitcher.stats.pitching.K++,this.count.outs++,pitcher.stats.pitching.IP[1]++,this.count.balls=this.count.strikes=0,this.says="Strike three. Batter out.",batter.atBats.push(Log.prototype.STRIKEOUT),this.newBatter()),this.count.balls>3&&(batter.stats.batting.pa++,batter.stats.batting.bb++,pitcher.stats.pitching.BB++,this.says="Ball four.",this.count.balls=this.count.strikes=0,batter.atBats.push(Log.prototype.WALK),this.advanceRunners(!0).reachBase().newBatter()),this.count.outs>2&&(this.says="Three outs, change.",this.count.outs=this.count.balls=this.count.strikes=0,pitcher.stats.pitching.IP[0]++,pitcher.stats.pitching.IP[1]=0,this.changeSides())},reachBase:function(){return this.game.field.first=this.game.batter,this.game.field.first.fatigue+=2,this},advanceRunners:function(isWalk){return isWalk=!!isWalk,isWalk?this.game.field.first&&(this.game.field.second?this.game.field.third?(this.game.batter.recordRBI(),this.game.batter.stats.batting.rbi++,this.game.field.third.atBats.push(Log.prototype.RUN),this.game.field.third.stats.batting.r++,this.game.pitcher.stats.pitching.ER++,this.game.scoreboard["top"==this.game.half?"away":"home"][this.game.inning]++,this.game.tally["top"==this.game.half?"away":"home"].R++,this.game.field.third=this.game.field.second,this.game.field.second=this.game.field.first,this.game.field.first=null):(this.game.field.third=this.game.field.second,this.game.field.second=this.game.field.first,this.game.field.first=null):this.game.field.third?(this.game.field.second=this.game.field.first,this.game.field.first=null):(this.game.field.second=this.game.field.first,this.game.field.first=null)):(this.game.field.third instanceof this.game.batter.constructor&&(this.game.scoreboard["top"==this.game.half?"away":"home"][this.game.inning]++,this.game.tally["top"==this.game.half?"away":"home"].R++,this.game.batter!=this.game.field.third&&(this.game.batter.recordRBI(),this.game.field.third.atBats.push(Log.prototype.RUN)),this.game.batter.stats.batting.rbi++,this.game.field.third.stats.batting.r++,this.game.pitcher.stats.pitching.ER++),this.game.field.third=this.game.field.second,this.game.field.second=this.game.field.first,this.game.field.first=null),this},newBatter:function(){this.game.log.pitchRecord={e:[],n:[]},this.count.balls=this.count.strikes=0,this.game.log.notePlateAppearanceResult(this.game);var team="bottom"==this.game.half?this.game.teams.home:this.game.teams.away;this.game.batter=team.lineup[(team.nowBatting+1)%9],this.game.deck=team.lineup[(team.nowBatting+2)%9],this.game.hole=team.lineup[(team.nowBatting+3)%9],team.nowBatting=(team.nowBatting+1)%9,this.count.outs<3&&this.game.log.noteBatter(this.game.batter)},changeSides:function(){this.game.swingResult.looking=!0,this.game.pitchInFlight.x=null,this.game.pitchInFlight.y=null,this.game.log.pitchRecord={e:[],n:[]};var offense,defense;if(this.game.field.first=null,this.game.field.second=null,this.game.field.third=null,"top"==this.game.half){if(9==this.game.inning&&this.game.tally.home.R>this.game.tally.away.R)return this.game.end();this.game.half="bottom"}else{if(this.game.inning+1>9)return this.game.end();this.game.inning++,this.game.half="top"}offense="top"==this.game.half?"away":"home",defense="top"==this.game.half?"home":"away";var n=this.game.inning+"回の"+("top"==this.game.half?"オモテ":"ウラ")+"、"+this.game.teams["top"==this.game.half?"away":"home"].getName()+"の攻撃。",e=("top"==this.game.half?"Top":"Bottom")+" "+this.game.inning;this.game.log.note(e,n);var team=this.game.teams[offense];this.game.batter=team.lineup[team.nowBatting],this.game.deck=team.lineup[(team.nowBatting+1)%9],this.game.hole=team.lineup[(team.nowBatting+2)%9],this.game.pitcher=this.game.teams[defense].positions.pitcher,this.game.log.noteBatter(this.game.batter)},says:"Play ball!",game:null};var Catcher=function(){this.init()};Catcher.prototype={init:function(){}};var Fielder=function(){this.init()};Fielder.prototype={init:function(){}};var Pitcher=function(){this.init()};Pitcher.prototype={init:function(){}};var Batter=function(){this.init()};Batter.prototype={init:function(){}};var Runner=function(){this.init()};Runner.prototype={init:function(){}},IndexController=function($scope){window.s=$scope,$scope.t=text,$scope.mode=function(setMode){return setMode&&(mode=setMode),mode},$scope.proceedToGame=function(quickMode,AIonly){if(Game.prototype.humanControl=AIonly?"none":"home",Game.prototype.quickMode=!!quickMode,$scope.y=new Game,s2.y=$scope.y,bindMethods(),jQ(".blocking").remove(),"none"==$scope.y.humanControl&&$scope.y.quickMode){var game=$scope.y,n=0;do n++,game.simulateInput(function(callback){"function"==typeof callback&&callback()});while("end"!=game.stage&&500>n);$scope.y=game,log("sim ended"),$scope.y.debugOut()}else if("none"==$scope.y.humanControl)var scalar=$scope.y.quickMode?.05:1,auto=setInterval(function(){"end"==$scope.y.stage&&clearInterval(auto),$scope.y.simulatePitchAndSwing(function(callback){$scope.y.quickMode?void 0:$scope.$apply(),$scope.updateFlightPath(callback)})},scalar*($scope.y.field.hasRunnersOn()?4e3:5500));"away"==$scope.y.humanControl&&$scope.y.simulateInput(function(callback){$scope.updateFlightPath(callback)}),"home"==$scope.y.humanControl};var bindMethods=function(){$scope.holdUpTimeouts=[],$scope.expandScoreboard=!1;var animator=new Animator;$scope.updateFlightPath=animator.updateFlightPath.bind($scope),$scope.selectPitch=function(pitchName){"pitch"==$scope.y.stage&&($scope.y.pitchInFlight=jQ.extend({},$scope.y.pitcher.pitching[pitchName]),$scope.y.pitchInFlight.name=pitchName,$scope.y.swingResult.looking=!0)},$scope.allowInput=!0,$scope.holdUp=function(){jQ(".no-swing").click(),$scope.$apply()},$scope.y.startOpponentPitching=function(callback){$scope.updateFlightPath(callback)},$scope.indicate=function($event){if($scope.allowInput&&!$scope.y.pitcher.windingUp){$scope.y.humanPitching()&&($scope.allowInput=!1);var offset=jQ(".target").offset(),relativeOffset={x:$event.pageX-offset.left,y:200-($event.pageY-offset.top)};for(clearTimeout($scope.lastTimeout);$scope.holdUpTimeouts.length;)clearTimeout($scope.holdUpTimeouts.shift());$scope.y.receiveInput(relativeOffset.x,relativeOffset.y,function(callback){$scope.updateFlightPath(callback)})}},$scope.abbreviatePosition=function(position){return"e"==mode?{pitcher:"P",catcher:"C",first:"1B",second:"2B","short":"SS",third:"3B",left:"LF",center:"CF",right:"RF"}[position]:text.fielderShortName(position)}}},ScoreboardDirective=function(){return{scope:{game:"=",text:"="},templateUrl:"js/internal/angular/views/directives/scoreboard.html?cache="+cacheKey,link:function(scope){window.s2=scope,scope.t=scope.text,scope.y=scope.game}}};var app=angular.module("YakyuuAikoukai",["directives"]);cacheKey=Math.floor(1500*Math.random()),angular.module("directives",[]).directive("scoreboard",ScoreboardDirective),angular.module("controllers",[]).controller("IndexController",IndexController);
//# sourceMappingURL=sourcemaps/application.js.map