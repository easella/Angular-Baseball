Yakyuu={},exports={};var mode="n";text=function(phrase,override){mode||(mode="n");var string={n:{empty:"-"," 1st":"1番"," 2nd":"2番"," 3rd":"3番"," 4th":"4番"," 5th":"5番"," 6th":"6番"," 7th":"7番"," 8th":"8番"," 9th":"9番","Now batting":"次のバッタ、","way outside":"相当外角",outside:"外角",inside:"内角","way inside":"相当内角","way low":"相当低め",low:"低め",high:"高め","way high":"相当高め","down the middle":"真ん中","first baseman":"ファースト","second baseman":"セカンド","third baseman":"サード",shortstop:"ショート",pitcher:"ピッチャー",catcher:"キャッチャー","left fielder":"レフト","center fielder":"センター","right fielder":"ライト","Strike.":"ストライク。","Ball.":"ボール。","Fouled off.":"ファウル。","In play.":"インプレー。","Swinging strike.":"空振り。","4-seam":"ストレート","2-seam":"シュート",slider:"スライダー",fork:"フォーク",cutter:"カット",sinker:"シンカー",curve:"カーブ",change:"チェンジ"," struck out looking.":"、見逃し三振。"," walked.":"、フォアボール。"," struck out swinging.":"、空振り三振。","Previous: ":"前：","looks like: ":"予想","breaking ball":"変化球",fastball:"ストレート","Batting, ":"打球","Catching, pitch selection":"捕球選択",Season:"記録",Game:"今試合",Pitch:"球",Control:"制球",Velocity:"速度",Break:"変化","At Bat :":"バッタ","On Deck :":"次バッタ","Eye :":"目","Power :":"力","Speed :":"速","Up to Bat":"打席",Fielding:"守備",BA:"打率",OBP:"出塁",SLG:"長打",PA:"打席","H/2B/3B/HR":"安／二／三／本",H:"安","2B":"二","3B":"三",HR:"本塁打",RBI:"打点",R:"得点",BB:"四球",SO:"三振","Select Language:":"言語","Run Fast Simulation":"シミュレーションを試合終了まで行う","Play Ball!":"プレーボール","Spectate the CPU":"CPU観戦","Throws/Bats":" ",LHP:"左投",RHP:"右投",LHB:"左打",RHB:"右打",L:"左投","R ":"右投"," L ":"左打"," R ":"右打","#":"背番号"},e:{empty:"-",Season:"Career"}}[override?override:mode][phrase];return string?string:phrase},text.getBattersEye=function(game){var eye={},breaking=Math.abs(game.pitchInFlight.breakDirection[0])+Math.abs(game.pitchInFlight.breakDirection[1])>40;return eye.e=text("looks like: ","e")+breaking?text("breaking ball","e"):text("fastball","e"),eye.n=text("looks like: ","n")+breaking?text("breaking ball","n"):text("fastball","n"),eye},text.fielderShortName=function(fielder){return"n"==mode?{first:"一",second:"二",third:"三","short":"遊",pitcher:"投",catcher:"捕",left:"左",center:"中",right:"右"}[fielder]:fielder},text.slash=function(){return"n"==mode?"・":"/"},text.fielderLongName=function(fielder){return"n"==mode?{first:"ファースト",second:"セカンド",third:"サード","short":"ショート",pitcher:"ピッチャー",catcher:"キャッチャー",left:"レフト",center:"センター",right:"ライト"}[fielder]:{first:text("first baseman"),second:text("second baseman"),third:text("third baseman"),"short":text("shortstop"),pitcher:text("pitcher"),catcher:text("catcher"),left:text("left fielder"),center:text("center fielder"),right:text("right fielder")}[fielder]},text.comma=function(){return{n:"、",e:", "}[mode]},text.stop=function(){return{n:"。",e:". "}[mode]},text.namePitch=function(pitch){return"e"==mode?pitch.name.charAt(0).toUpperCase()+pitch.name.slice(1):"n"==mode?text(pitch.name):void 0},text.contactResult=function(batter,fielder,bases,outBy){var statement="",infield=["left","center","right"].indexOf(fielder)<0;if("e"==mode){if(statement+=batter,outBy)switch(outBy){case"error":statement+=" reached on error by "+text.fielderShortName(fielder);break;case"pop":statement+=" popped out to "+text.fielderShortName(fielder);break;case"fly":statement+=" flew out to "+text.fielderShortName(fielder);break;case"ground":statement+=" grounded out to "+text.fielderShortName(fielder);break;case"thrown":statement+=" was thrown out by "+text.fielderShortName(fielder)}else switch(bases){case 1:statement+=infield?" reached on an infield hit to "+text.fielderShortName(fielder):" reached on a single to "+text.fielderShortName(fielder);break;case 2:statement+=" doubled past "+text.fielderShortName(fielder);break;case 3:statement+=" tripled past "+text.fielderShortName(fielder);break;case 4:statement+=" homered to "+text.fielderShortName(fielder)}statement+=text.stop()}if("n"==mode){if(statement+=batter+"は",outBy)switch(fielder=text.fielderShortName(fielder),outBy){case"error":statement+="エラー("+fielder+")で出塁";break;case"pop":statement+="ポップフライで"+fielder+"飛";break;case"fly":statement+=fielder+"飛";break;case"ground":statement+=fielder+"ゴロ";break;case"thrown":statement+=fielder+"ゴロ"}else switch(fielder=text.fielderLongName(fielder),bases){case 1:statement+=infield?"内野安打("+fielder+")で出塁":"安打("+fielder+")で出塁";break;case 2:statement+="二塁打（"+fielder+"）で出塁";break;case 3:statement+="三塁打（"+fielder+"）で出塁";break;case 4:statement+="本塁打（"+fielder+"）"}statement+=text.stop()}return statement},exports.text=text,exports.mode=mode;var Log=function(){this.init()};Log.prototype={game:"instance of Game",init:function(){this.pitchRecord={e:[],n:[]}},SINGLE:"H",DOUBLE:"2B",TRIPLE:"3B",HOMERUN:"HR",WALK:"BB",GROUNDOUT:"GO",FLYOUT:"FO",LINEOUT:"LO",RUN:"R",STRIKEOUT:"SO",SACRIFICE:"SAC",REACHED_ON_ERROR:"ROE",FIELDERS_CHOICE:"FC",note:function(note,noteJ){this.record.e.unshift(note);var rec=this.record.e.slice(0,6);this.shortRecord.e=rec,this.stabilized.shortRecord.e=rec.concat(["","","","","",""]).slice(0,6),this.record.n.unshift(noteJ);var rec2=this.record.n.slice(0,6);this.shortRecord.n=rec2,this.stabilized.shortRecord.n=rec2.concat(["","","","","",""]).slice(0,6)},getBatter:function(batter){var order=batter.team.nowBatting;order={0:text(" 1st"),1:text(" 2nd"),2:text(" 3rd"),3:text(" 4th"),4:text(" 5th"),5:text(" 6th"),6:text(" 7th"),7:text(" 8th"),8:text(" 9th")}[order];var positions=this.longFormFielder();return text("Now batting")+order+text.comma()+positions[batter.position]+text.comma()+batter.getUniformNumber()+text.comma()+batter.getName()},noteBatter:function(batter){var record,recordJ,m=mode;mode="e",record=this.getBatter(batter),mode="n",recordJ=this.getBatter(batter),mode=m,this.note(record,recordJ)},getPitchLocationDescription:function(pitchInFlight,batterIsLefty){var x=pitchInFlight.x,y=pitchInFlight.y,say="",noComma=!1,noComma2=!1,ball=!1;return batterIsLefty||(x=200-x),50>x?(say+=text("way outside"),ball=!0):70>x?say+=text("outside"):100>x?(say+="",noComma=!0):130>x?(say+="",noComma=!0):150>x?say+=text("inside"):(say+=text("way inside"),ball=!0),""!=say&&(say+=text.comma()),35>y?(say+=text("way low"),ball=!0):65>y?say+=text("low"):135>y?(say+="",noComma2=!0):165>y?say+=text("high"):(say+=text("way high"),ball=!0),(noComma||noComma2)&&(say=say.split(text.comma()).join(""),noComma&&noComma2&&(say=text("down the middle"))),say=text.namePitch(pitchInFlight)+text.comma()+say+text.stop()},notePitch:function(pitchInFlight,batter){var record,recordJ,m=mode;mode="e",record=this.getPitchLocationDescription(pitchInFlight,"left"==batter.bats),this.pitchRecord.e.unshift(record),this.stabilized.pitchRecord.e.unshift(record),this.stabilized.pitchRecord.e.pop(),mode="n",recordJ=this.getPitchLocationDescription(pitchInFlight,"left"==batter.bats),this.pitchRecord.n.unshift(recordJ),this.stabilized.pitchRecord.n.unshift(recordJ),this.stabilized.pitchRecord.n.pop(),mode=m},getSwing:function(swingResult){var result="";return result+=text(swingResult.looking?swingResult.strike?"Strike.":"Ball.":swingResult.contact?swingResult.foul?"Fouled off.":swingResult.caught?"In play.":swingResult.thrownOut?"In play.":"In play.":"Swinging strike.")},noteSwing:function(swingResult){var record,recordJ,m=mode;mode="e",record=this.getSwing(swingResult),this.pitchRecord.e[0]+=record,this.stabilized.pitchRecord.e[0]+=record,mode="n",recordJ=this.getSwing(swingResult),this.pitchRecord.n[0]+=recordJ,this.stabilized.pitchRecord.n[0]+=recordJ,mode=m},getPlateAppearanceResult:function(game){var r=game.swingResult,record="",batter=game.batter.getName();if(r.looking)record=r.strike?batter+text(" struck out looking."):batter+text(" walked.");else if(r.contact){var outBy,fielder=r.fielder,bases=r.bases;if(r.caught)outBy=["left","center","right"].indexOf(r.fielder)<0?"pop":"fly";else if(r.foul);else if(r.error)bases=1,outBy="error";else if(r.thrownOut)outBy=Math.random()>.5?"ground":"thrown";else switch(r.bases){case 1:case 2:case 3:bases=r.bases;break;case 4:bases=4,fielder=r.splay<-15?"left":r.splay<15?"center":"right"}record=text.contactResult(batter,fielder,bases,outBy)}else record=batter+text(" struck out swinging.");return record},notePlateAppearanceResult:function(game){var record,recordJ,m=mode;mode="e",record=this.getPlateAppearanceResult(game),this.record.e.unshift(record),this.pitchRecord.e=[text("Previous: ")+record],this.stabilized.pitchRecord.e=[text("Previous: ")+record,"","","","",""],mode="n",recordJ=this.getPlateAppearanceResult(game),this.record.n.unshift(recordJ),this.pitchRecord.n=[text("Previous: ")+recordJ],this.stabilized.pitchRecord.n=[text("Previous: ")+recordJ,"","","","",""],mode=m},pointer:0,stabilized:{pitchRecord:{e:["","","","","",""],n:["","","","","",""]},shortRecord:{e:["","","","","",""],n:["","","","","",""]}},pitchRecord:{e:[],n:[]},shortRecord:{e:[],n:[]},record:{e:[],n:[]},longFormFielder:function(){return{first:text("first baseman"),second:text("second baseman"),third:text("third baseman"),"short":text("shortstop"),pitcher:text("pitcher"),catcher:text("catcher"),left:text("left fielder"),center:text("center fielder"),right:text("right fielder")}}},exports.Log=Log,data={surnames:["Sato","Suzuki","Takahashi","Tanaka","Watanabe","Ito","Nakamura","Kobayashi","Yamamoto","Kato","Yoshida","Yamada","Sasaki","Yamaguchi","Matsumoto","Inoue","Kimura","Shimizu","Hayashi","Saito","Saito","Yamazaki","Nakajima","Mori","Abe","Ikeda","Hashimoto","Ishikawa","Yamashita","Ogawa","Ishii","Hasegawa","Goto","Okada","Kondo","Maeda","Fujita","Endo","Aoki","Sakamoto","Murakami","Ota","Kaneko","Fujii","Fukuda","Nishimura","Miura","Takeuchi","Nakagawa","Okamoto","Matsuda","Harada","Nakano"],surnamesJ:["佐藤","鈴木","高橋","田中","渡辺","伊藤","中村","小林","山本","加藤","吉田","山田","佐々木","山口","松本","井上","木村","清水","林","斉藤","斎藤","山崎","中島","森","阿部","池田","橋本","石川","山下","小川","石井","長谷川","後藤","岡田","近藤","前田","藤田","遠藤","青木","坂本","村上","太田","金子","藤井","福田","西村","三浦","竹内","中川","岡本","松田","原田","中野"],namesJ:["匠","ヒカル","ゆうき","翔太","冬馬","漣","港区","ルイ","樹","賢治","五木","春","光一","宗介","こうすけ","雄太","大樹","瑛太","宏","亨","道夫","聡","昭","茂雄","勝","純一","和夫","勲","省三","隆","達夫","正一","輝夫","俊夫","史郎","勇","義弘","良雄","登","義明","正義","秀夫","肇","月","克己","正男","光男","久","耕三","清","次郎","正博","明子","武","勉","晴夫","裕二","稔","障子","和子","敦","茂","信夫","恵一","忠","高尾","薫","ケン","健治","哲夫","啓二","光一","真一","貞夫","靖","武","雄","文雄","久雄","一朗","健一","正明","五郎","誠","昭夫","誠司","洋一","康夫","誠一","正美","則夫","幸雄","忠雄","仁","シンジ","豊","邦雄","修","雅之","三郎","英治","浩二","栄一","恒夫","義郎","進","博之","巌"],names:["Takumi","Hikaru","Yuuki","Shouta","Touma","Ren","Minato","Rui","Tatsuki","Kenji","Itsuki","Haru","Kouichi","Sousuke","Kousuke","Yuuta","Daiki","Eita","Hiroshi","Toru","Michio","Satoshi","Akira","Shigeo","Masaru","Junichi","Kazuo","Isao","Shozo","Takashi","Tatsuo","Shoichi","Teruo","Toshio","Shiro","Isamu","Yoshihiro","Yoshio","Noboru","Yoshiaki","Tadayoshi","Hideo","Hajime","Akari","Katsumi","Masao","Mitsuo","Hisashi","Kozo","Kiyoshi","Jiro","Masahiro","Akiko","Takeshi","Tsutomu","Haruo","Yuji","Minoru","Shoji","Kazuko","Atsushi","Shigeru","Shinobu","Keiichi","Tadashi","Takao","Kaoru","Ken","Kenji","Tetsuo","Keiji","Koichi","Shinichi","Sadao","Yasushi","Takeshi","Yu","Fumio","Hisao","Ichiro","Kenichi","Masaaki","Goro","Makoto","Akio","Seiji","Yoichi","Yasuo","Seiichi","Masami","Norio","Yukio","Tadao","Hitoshi","Shinji","Yutaka","Kunio","Osamu","Masayuki","Saburo","Eiji","Koji","Eiichi","Tsuneo","Yoshio","Susumu","Hiroyuki","Iwao"],teamNamesJ:["横浜","大阪","名古屋","札幌","神戸","京都","福岡","川崎","埼玉県","広島","仙台","千葉県","新潟","浜松","静岡","相模原","岡山","熊本","鹿児島","船橋","川口","姫路","松山","宇都宮","松戸","西宮","倉敷","市川","福山","尼崎","金沢","長崎","横須賀","富山","高松","町田","岐阜","枚方","藤沢","柏","豊中","長野県","豊橋","一宮","和歌山","岡崎","宮崎","奈良","吹田","高槻","旭川","いわき","高崎","所沢","川越","秋田","越谷","前橋","那覇","四日市","青森","久留米","春日井","盛岡","明石","福島","下関","長岡","市原","函館","茨城県","福井","加古川","徳島","水戸","平塚","佐世保","呉","八戸","佐賀","寝屋川","富士","春日部","茅ヶ崎","松本","厚木","大和","上尾","宝塚","筑波","沼津","熊谷","伊勢崎","岸和田","鳥取","小田原","鈴鹿","松江","日立"],teamNames:["Yokohama","Osaka","Nagoya","Sapporo","Kobe","Kyoto","Fukuoka","Kawasaki","Saitama","Hiroshima","Sendai","Chiba","Niigata","Hamamatsu","Shizuoka","Sagamihara","Okayama","Kumamoto","Kagoshima","Funabashi","Kawaguchi","Himeji","Matsuyama","Utsunomiya","Matsudo","Nishinomiya","Kurashiki","Ichikawa","Fukuyama","Amagasaki","Kanazawa","Nagasaki","Yokosuka","Toyama","Takamatsu","Machida","Gifu","Hirakata","Fujisawa","Kashiwa","Toyonaka","Nagano","Toyohashi","Ichinomiya","Wakayama","Okazaki","Miyazaki","Nara","Suita","Takatsuki","Asahikawa","Iwaki","Takasaki","Tokorozawa","Kawagoe","Akita","Koshigaya","Maebashi","Naha","Yokkaichi","Aomori","Kurume","Kasugai","Morioka","Akashi","Fukushima","Shimonoseki","Nagaoka","Ichihara","Hakodate","Ibaraki","Fukui","Kakogawa","Tokushima","Mito","Hiratsuka","Sasebo","Kure","Hachinohe","Saga","Neyagawa","Fuji","Kasukabe","Chigasaki","Matsumoto","Atsugi","Yamato","Ageo","Takarazuka","Tsukuba","Numazu","Kumagaya","Isesaki","Kishiwada","Tottori","Odawara","Suzuka","Matsue","Hitachi"]},exports.data=data,helper={pitchDefinitions:{"4-seam":[0,0,1],"2-seam":[20,-20,.9],cutter:[-25,-20,.95],sinker:[-15,-30,.95],slider:[-50,-35,.9],fork:[0,-70,.87],curve:[0,-90,.82],change:[0,-10,.88]},selectRandomPitch:function(){return["4-seam","2-seam","cutter","sinker","slider","fork","curve","change"][Math.floor(8*Math.random())]}},exports.helper=helper;var Animator=function(){this.init()};Animator.prototype={identifier:"Animator",constructor:Animator,console:!1,init:function(){},pitchTarget:null,pitchBreak:null,updateFlightPath:function(callback){if(!Animator.console){var $scope=this,game=$scope.y,top=200-game.pitchTarget.y,left=game.pitchTarget.x,breakTop=200-game.pitchInFlight.y,breakLeft=game.pitchInFlight.x,$baseballs=jQ(".baseball"),flightSpeed=1.3-.6*(game.pitchInFlight.velocity+300)/400,originTop=50,originLeft=110+("left"==game.pitcher["throws"]?20:-20),pitch=this.pitchTarget=jQ(".main-area .target .baseball.pitch"),henka=this.pitchBreak=jQ(".main-area .target .baseball.break"),quarter=flightSpeed/4,pitchTransition=Mathinator.pitchTransition(top,left,originTop,originLeft,quarter),transitions=[pitchTransition(0,0),pitchTransition(10,0),pitchTransition(30,1),pitchTransition(50,2),pitchTransition(100,3),pitchTransition(100,3,breakTop,breakLeft)];TweenMax.set([pitch,henka],transitions[0]),TweenMax.to([pitch,henka],quarter,transitions[1]),TweenMax.to([pitch,henka],quarter,transitions[2]),TweenMax.to([pitch,henka],quarter,transitions[3]),TweenMax.to(pitch,quarter,transitions[4]),TweenMax.to(henka,quarter,transitions[5]),$scope.lastTimeout=setTimeout(function(){$scope.allowInput=!0,"function"==typeof callback&&(callback(),$scope.$apply())},1e3*flightSpeed),game.pitchInFlight.x?(game.humanBatting()&&100*Math.random()>game.batter.skill.offense.eye?jQ(".baseball.break").addClass("hide"):jQ(".baseball.break").removeClass("hide"),jQ(".baseball.pitch").removeClass("hide")):$baseballs.addClass("hide"),$scope.y.humanBatting()&&!$scope.y.humanPitching()&&$scope.holdUpTimeouts.push(setTimeout(function(){$scope.holdUp()},1e3*(flightSpeed+1.2)))}},animateFieldingTrajectory:function(game){if(Animator.console)return game.swingResult;var ball=jQ(".splay-indicator-ball");TweenMax.killAll();var result=game.swingResult,linearApproximateDragScalar={distance:1,apexHeight:.37,airTime:.66},angle=result.flyAngle,distance=Math.abs(result.travelDistance),scalar=result.travelDistance<0?-1:1;Mathinator.memory.bounding=0>angle,angle=1+Math.abs(angle),angle>90&&(angle=180-angle);var velocity=linearApproximateDragScalar.distance*Math.sqrt(9.81*distance/Math.sin(2*Math.PI*angle/180)),apexHeight=velocity*velocity/19.62*linearApproximateDragScalar.apexHeight,airTime=Math.sqrt(2*apexHeight/9.81)*linearApproximateDragScalar.airTime,quarter=airTime/4,mathinator=new Mathinator,transitions=[mathinator.transitionalTrajectory(0,quarter,0,apexHeight,scalar*distance,result.splay),mathinator.transitionalTrajectory(25,quarter,0),mathinator.transitionalTrajectory(50,quarter,1),mathinator.transitionalTrajectory(75,quarter,2),mathinator.transitionalTrajectory(100,quarter,3)];return TweenMax.set(ball,transitions[0]),TweenMax.to(ball,quarter,transitions[1]),TweenMax.to(ball,quarter,transitions[2]),TweenMax.to(ball,quarter,transitions[3]),TweenMax.to(ball,quarter,transitions[4]),game.swingResult}};for(var fn in Animator.prototype)Animator.prototype.hasOwnProperty(fn)&&(Animator[fn]=Animator.prototype[fn]);exports.Animator=Animator;var Distribution=function(){};Distribution.prototype={identifier:"Distribution",constructor:Distribution,chance:function(scale){return scale||(scale=1),Math.random()*scale},error:function(fielder){return.4*(100-fielder.skill.defense.fielding)+4>100*Math.random()},landingDistance:function(power,flyAngle){return(10+power/2+310*Math.random()+power/100*30)*(1-Math.abs(flyAngle-30)/60)},pitchLocation:function(){var x,y;return x=Math.random()<.5?50+Math.floor(70*Math.random())-Math.floor(15*Math.random()):150+Math.floor(15*Math.random())-Math.floor(70*Math.random()),y=30+(170-Math.floor(Math.sqrt(28900*Math.random()))),{x:x,y:y}},centralizedNumber:function(){return 100+Math.floor(15*Math.random())-Math.floor(15*Math.random())},swingLikelihood:function(eye,x,y,umpire){var swingLikelihood=(200-Math.abs(100-x)-Math.abs(100-y))/2;return swingLikelihood=60>x||x>140||50>y||y>150?Math.min(swingLikelihood,100-eye)-15*umpire.count.balls:Math.max(45,(2*swingLikelihood+eye)/3),swingLikelihood-35+10*(umpire.count.balls+2*umpire.count.strikes)},pitchControl:function(target,control){return Math.min(199.9,Math.max(.1,target+(50-100*Math.random())/(1+control/100)))},breakEffect:function(pitch,x,y){var effect={};return effect.x=Math.floor(x+pitch.breakDirection[0]*((.5+Math.random()*pitch["break"])/100)),effect.y=Math.floor(y+pitch.breakDirection[1]*((.5+Math.random()*pitch["break"])/100)/(.5+y/200)),effect},cpuSwing:function(target,actual,eye){return eye=Math.max(eye,100),100+(target-100)*(.5+Math.random()*eye/200)-actual},swing:function(eye){return 100/(eye+25+50*Math.random())}};for(var fn in Distribution.prototype)Distribution.prototype.hasOwnProperty(fn)&&(Distribution[fn]=Distribution.prototype[fn]);exports.Distribution=Distribution;var Iterator=function(){};Iterator.prototype={identifier:"Iterator",constructor:Iterator,each:function(collection,map){var keys,i;if(collection instanceof Array)for(i=0;i<collection.length;i++)map(i,collection[i]);else for(keys=Object.keys(collection),i=0;i<keys.length;i++)map(keys[i],collection[keys[i]])}};for(var fn in Iterator.prototype)Iterator.prototype.hasOwnProperty(fn)&&(Iterator[fn]=Iterator.prototype[fn]);exports.Iterator=Iterator;var Mathinator=function(){};Mathinator.square=function(n){return n*n},Mathinator.prototype={identifier:"Mathinator",constructor:Mathinator,RADIAN:Math.PI/180,SPLAY_INDICATOR_LEFT:-4,getAngularOffset:function(offset,angle){var xScalar=offset.x<0?-1:1,yScalar=offset.y<0?-1:1,originalAngle=Math.atan(offset.x/offset.y)/this.RADIAN,distance=Math.sqrt(offset.x*offset.x+offset.y*offset.y),angledY=yScalar*Math.cos((angle-originalAngle)*this.RADIAN)*distance,angledX=xScalar*Math.sqrt(distance*distance-angledY*angledY);return{x:angledX,y:angledY}},getPolarDistance:function(a,b){var radians=this.RADIAN;return Math.sqrt(a[1]*a[1]+b[1]*b[1]-2*a[1]*b[1]*Math.cos(a[0]*radians-b[0]*radians))},battingAngle:function(origin,target){return Math.atan((origin.y-target.y)/(target.x-origin.x))/Math.PI*125},memory:{},transitionalTrajectory:function(percent,quarter,step,givenApexHeight,givenDistance,givenSplayAngle){givenApexHeight&&(Mathinator.prototype.memory.apexHeight=givenApexHeight),givenDistance&&(Mathinator.prototype.memory.distance=givenDistance),givenSplayAngle&&(Mathinator.prototype.memory.splay=givenSplayAngle);var bottom,left,padding,borderWidth,apexHeight=Mathinator.prototype.memory.apexHeight,distance=Mathinator.prototype.memory.distance,splay=Mathinator.prototype.memory.splay,bounding=Mathinator.prototype.memory.bounding,radian=this.RADIAN;bottom=Math.cos(splay*radian)*percent/100*distance*95/300,left=Math.sin(splay*radian)*percent/100*distance*95/300+this.SPLAY_INDICATOR_LEFT;var apexRatio=Math.sqrt((50-Math.abs(percent-50))/100)*(1/.7071);return bounding?(padding=1,borderWidth=1):(padding=apexRatio*apexHeight/90*15,borderWidth=2+2*apexRatio),bottom=Math.max(Math.min(bottom,400),-20),left=Math.max(Math.min(left,100),-100),padding=Math.max(Math.min(padding,40),0),{bottom:bottom,left:left,padding:padding,borderWidth:borderWidth,delay:quarter*step,ease:bounding?Power4.easeOut:Linear.easeNone}},translateSwingResultToStylePosition:function(swingResult){var bottom,left;return bottom=Math.cos(swingResult.splay/180*Math.PI)*swingResult.travelDistance*95/300,left=Math.sin(swingResult.splay/180*Math.PI)*swingResult.travelDistance*95/300+this.SPLAY_INDICATOR_LEFT,bottom=Math.max(Math.min(bottom,400),-20),left=Math.max(Math.min(left,100),-100),swingResult.bottom=bottom+"px",swingResult.left=left+"px",swingResult},pitchTransition:function(top,left,originTop,originLeft,quarter){return function(percent,step,breakTop,breakLeft){var _top,_left;_top=breakTop||top,_left=breakLeft||left,_top=originTop+Mathinator.square(percent/100)*(_top-originTop),_left=originLeft+Mathinator.square(percent/100)*(_left-originLeft);var padding=Math.max(13*Mathinator.square(percent/100),1),borderWidth=Math.max(4*Mathinator.square(percent/100),1);return{top:_top,left:_left,padding:padding+"px",borderWidth:borderWidth+"px",transform:"translateZ(0)",delay:quarter*step,ease:Linear.easeNone}}},fielderReturnDelay:function(distance,throwing,fielding,intercept){return distance/90+distance/90/(.5+throwing/2)+1-(.2+.8*fielding)+9*(distance/310)*Math.min(intercept-120,0)/-240},baseRunningTime:function(speed){return 6-speed/100*2.2}};for(var fn in Mathinator.prototype)Mathinator.prototype.hasOwnProperty(fn)&&(Mathinator[fn]=Mathinator.prototype[fn]);exports.Mathinator=Mathinator;var AtBat=function(text){this.infield=text.indexOf(AtBat.prototype.INFIELD_HIT_INDICATOR)>-1?AtBat.prototype.INFIELD_HIT_INDICATOR:"",text=text.replace(AtBat.prototype.INFIELD_HIT_INDICATOR,""),this.text=text.split(AtBat.prototype.RBI_INDICATOR)[0],this.rbi=text.split(this.text)[1]+"";var log=new Log,beneficial=[log.WALK,log.SINGLE,log.HOMERUN,log.DOUBLE,log.TRIPLE,log.SACRIFICE,log.REACHED_ON_ERROR];beneficial.indexOf(this.text)>-1&&(this.beneficial=!0)};AtBat.prototype.toString=function(){return""+this.infield+this.text+this.rbi},AtBat.prototype.constructor=AtBat,AtBat.prototype.identifier="AtBat",AtBat.prototype.INFIELD_HIT_INDICATOR="",AtBat.prototype.RBI_INDICATOR="+",exports.AtBat=AtBat;var Field=function(game){this.init(game)};Field.prototype={constructor:Field,init:function(game){this.game=game,this.first=null,this.second=null,this.third=null},hasRunnersOn:function(){return this.first instanceof Player||this.second instanceof Player||this.third instanceof Player},determineSwingContactResult:function(swing){var x=swing.x,y=swing.y,splayAngle=90-1.5*x+swing.angle*y/35,flyAngle=-3*y-swing.angle*y/35,power=this.game.batter.skill.offense.power+(this.game.batter.eye.bonus||0)/5,landingDistance=Distribution.landingDistance(power,flyAngle);if(0>flyAngle&&landingDistance>120&&(landingDistance=(landingDistance-120)/4+120),Math.abs(90-splayAngle)>50&&(swing.foul=!0),swing.fielder=this.findFielder(splayAngle,landingDistance),swing.travelDistance=landingDistance,swing.flyAngle=flyAngle,swing.splay=splayAngle-90,swing.sacrificeAdvances=[],swing.fielder){var fielder="top"==this.game.half?this.game.teams.home.positions[swing.fielder]:this.game.teams.away.positions[swing.fielder];fielder.fatigue+=4,swing.error=!1;var fieldingEase=fielder.skill.defense.fielding/100,throwingEase=fielder.skill.defense.throwing/100;swing.fielderTravel=this.getPolarDistance(this.positions[swing.fielder],[splayAngle,landingDistance]);var interceptRating=fielder.skill.defense.speed+flyAngle-1.65*swing.fielderTravel;if(interceptRating>0&&flyAngle>-10)if(Distribution.error(fielder))fieldingEase*=.5,swing.error=!0,swing.caught=!1;else{swing.caught=!0;var sacrificeThrowInTime=Mathinator.fielderReturnDelay(swing.travelDistance,throwingEase,fieldingEase,100);this.first&&sacrificeThrowInTime>this.first.getBaseRunningTime()+1.5&&swing.sacrificeAdvances.push("first"),this.second&&sacrificeThrowInTime>this.second.getBaseRunningTime()&&swing.sacrificeAdvances.push("second"),this.third&&sacrificeThrowInTime>this.third.getBaseRunningTime()-.5&&swing.sacrificeAdvances.push("third")}else swing.caught=!1;if(!swing.caught){swing.bases=0,swing.thrownOut=!1;var fieldingReturnDelay=Mathinator.fielderReturnDelay(swing.travelDistance,throwingEase,fieldingEase,interceptRating);swing.fieldingDelay=fieldingReturnDelay,swing.outFielder=1=={left:1,center:1,right:1}[swing.fielder];var speed=this.game.batter.skill.offense.speed,baseRunningTime=Mathinator.baseRunningTime(speed);if(swing.outFielder){swing.bases=1,fieldingReturnDelay-=baseRunningTime;for(var difficulty=1.8;fieldingReturnDelay>baseRunningTime+difficulty&&swing.bases<3;)swing.bases++,difficulty=-1.3,fieldingReturnDelay-=baseRunningTime}else swing.fieldersChoice=null,swing.bases=fieldingReturnDelay>=baseRunningTime+1?1:0,this.first&&fieldingReturnDelay<this.first.getBaseRunningTime()&&(swing.fieldersChoice="first"),this.second&&fieldingReturnDelay<this.second.getBaseRunningTime()+.6&&(swing.fieldersChoice="second"),this.third&&fieldingReturnDelay<this.third.getBaseRunningTime()&&(swing.fieldersChoice="third"),swing.fieldersChoice&&(swing.bases=1);swing.thrownOut=0==swing.bases,swing.thrownOut&&(swing.thrownOut=!0,swing.error=!1)}}else Math.abs(90-splayAngle)<45&&landingDistance>300?swing.bases=4:(swing.foul=!0,swing.caught=!1);return this.game.swingResult=swing,Animator.animateFieldingTrajectory(this.game)},findFielder:function(splayAngle,landingDistance){return Math.abs(90-splayAngle)>50?!1:10>landingDistance&&landingDistance>-20?"catcher":landingDistance>=10&&66>landingDistance&&Math.abs(90-splayAngle)<5?"pitcher":landingDistance>20&&landingDistance+Math.abs(90-splayAngle)/90*37<155?68>splayAngle?"third":91>splayAngle?"short":114>splayAngle?"second":"first":landingDistance>90&&310>landingDistance?73>splayAngle?"left":107>splayAngle?"center":"right":!1},positions:{pitcher:[90,66],catcher:[0,0],first:[128,98],second:[102.5,130],"short":[77.5,130],third:[52,98],left:[59,280],center:[90,280],right:[121,280]},getPolarDistance:function(a,b){return Mathinator.getPolarDistance(a,b)},fieldingTest:function(){var angle=90*Math.random()+45,distance=320*Math.random(),fielder=this.findFielder(angle,distance),data={};if(fielder){var fielderCandidates=this.fielderSelectionTest(angle,distance,!0);return data.fielder=fielderCandidates[1],data[fielderCandidates[0]]=this.getPolarDistance([angle,distance],[this.positions[fielderCandidates[0]][0],this.positions[fielderCandidates[0]][1]]),data[fielderCandidates[1]]=this.getPolarDistance([angle,distance],[this.positions[fielderCandidates[1]][0],this.positions[fielderCandidates[1]][1]]),data}},aggregateFieldingTest:function(){for(var fielders={pitcher:{tally:0,distances:[]},catcher:{tally:0,distances:[]},first:{tally:0,distances:[]},second:{tally:0,distances:[]},"short":{tally:0,distances:[]},third:{tally:0,distances:[]},left:{tally:0,distances:[]},center:{tally:0,distances:[]},right:{tally:0,distances:[]},"false":{tally:0,distances:[]}},selections=[],i=0;1e3>i;i++){var angle=90*Math.random()+45,distance=320*Math.random(),fielder=this.findFielder(angle,distance);fielders[fielder].tally++,fielder&&fielders[fielder].distances.push(this.getPolarDistance([angle,distance],[this.positions[fielder][0],this.positions[fielder][1]])),selections.push([angle,distance]),selections.push(this.fielderSelectionTest(angle,distance,!0))}return[fielders,selections]},fielderSelectionTest:function(angle,distance,returnFielder){var distances=[],minDistance=300,giraffe=this,fielder=!1;return Iterator.each(this.positions,function(position,spot){var thisDistance=giraffe.getPolarDistance([angle,distance],spot);distances[thisDistance]=position,minDistance>thisDistance&&(minDistance=thisDistance,fielder=position)}),returnFielder?[fielder,this.findFielder(angle,distance)]:distances}},exports.Field=Field;var Game=function(m){this.init(m)};Game.prototype={constructor:Game,gamesIntoSeason:0,humanControl:"none",console:!1,quickMode:!0,debug:[],init:function(m){for(m&&(window.mode=m),this.gamesIntoSeason=1+Math.floor(142*Math.random()),this.field=new Field(this),this.teams.away=new Team(this),this.teams.home=new Team(this),this.log=new Log,this.log.game=this,this.debug=[],this.helper=helper;this.teams.away.name==this.teams.home.name;)this.teams.away.pickName();this.umpire=new Umpire(this),this.humanPitching()&&(this.stage="pitch")},getInning:function(){return"n"==mode?this.inning+("top"==this.half?"オモテ":"ウラ"):this.half.toUpperCase()+" "+this.inning},humanBatting:function(){if("none"==this.humanControl)return!1;switch(this.half){case"top":return"both"==this.humanControl||"away"==this.humanControl;case"bottom":return"both"==this.humanControl||"home"==this.humanControl}},humanPitching:function(){if("none"==this.humanControl)return!1;switch(this.half){case"top":return"both"==this.humanControl||"home"==this.humanControl;case"bottom":return"both"==this.humanControl||"away"==this.humanControl}},end:function(){this.stage="end";var e,n;e=this.tally.home.R>this.tally.away.R?"Home team wins!":this.tally.home.R==this.tally.away.R?"You tied. Yes, you can do that.":"Visitors win!",n=this.tally.home.R>this.tally.away.R?this.teams.home.getName()+"の勝利":this.tally.home.R==this.tally.away.R?"引き分け":this.teams.away.getName()+"の勝利",this.log.note(e,n)},stage:"pitch",simulateInput:function(callback){"end"!=this.stage&&("pitch"==this.stage?this.autoPitch(callback):"swing"==this.stage&&("object"!=typeof this.pitchTarget&&(this.pitchTarget={x:100,y:100}),this.autoSwing(this.pitchTarget.x,this.pitchTarget.y,callback)))},simulatePitchAndSwing:function(callback){if("end"!=this.stage){this.autoPitch(callback);var giraffe=this;setTimeout(function(){"object"!=typeof giraffe.pitchTarget&&(giraffe.pitchTarget={x:100,y:100}),giraffe.autoSwing(giraffe.pitchTarget.x,giraffe.pitchTarget.y,function(callback){callback()})},giraffe.field.hasRunnersOn()?2400:3900)}},receiveInput:function(x,y,callback){"none"!=this.humanControl&&"end"!=this.stage&&("pitch"==this.stage&&this.humanPitching()?this.thePitch(x,y,callback):"swing"==this.stage&&this.humanBatting()&&this.theSwing(x,y,callback))},autoPitchSelect:function(){for(var pitchName=this.helper.selectRandomPitch();!this.pitcher.pitching.hasOwnProperty(pitchName);)pitchName=this.helper.selectRandomPitch();var pitch=this.pitcher.pitching[pitchName];pitch.name=pitchName,this.pitchInFlight=pitch},autoPitch:function(callback){var pitcher=this.pitcher,giraffe=this;if("pitch"==this.stage){if(pitcher.windingUp=!0,!this.console){jQ(".baseball").addClass("hide");var windup=jQ(".windup");windup.css("width","100%")}this.autoPitchSelect();var pitch=Distribution.pitchLocation(),x=pitch.x,y=pitch.y;this.quickMode?this.thePitch(x,y,callback):windup.animate({width:0},this.field.hasRunnersOn()?1500:3e3,function(){!giraffe.console&&jQ(".baseball.pitch").removeClass("hide"),giraffe.thePitch(x,y,callback),pitcher.windingUp=!1})}},autoSwing:function(deceptiveX,deceptiveY,callback){var convergence,convergenceSum,giraffe=this,bonus=this.batter.eye.bonus||0,eye=this.batter.skill.offense.eye+6*(this.umpire.count.balls+this.umpire.count.strikes)+bonus,x=Distribution.centralizedNumber(),y=Distribution.centralizedNumber();100*Math.random()<eye?(convergence=6.75*eye/100,convergenceSum=1+convergence,deceptiveX=this.pitchInFlight.x,deceptiveY=this.pitchInFlight.y):(convergence=2.7*eye/100,convergenceSum=1+convergence),x=(deceptiveX*convergence+x)/convergenceSum,y=(deceptiveY*convergence+y)/convergenceSum,this.swingResult.x=Distribution.cpuSwing(x,this.pitchInFlight.x,eye),this.swingResult.y=Distribution.cpuSwing(y,this.pitchInFlight.y,eye);var swingProbability=Distribution.swingLikelihood(eye,x,y,this.umpire);

swingProbability<100*Math.random()&&(x=-20),callback(function(){giraffe.theSwing(x,y)})},thePitch:function(x,y,callback){if("pitch"==this.stage){this.pitcher.fatigue++,this.pitchTarget.x=x,this.pitchTarget.y=y,this.pitchInFlight.breakDirection=this.helper.pitchDefinitions[this.pitchInFlight.name].slice(0,2),this.battersEye=text.getBattersEye(this);var control=this.pitchInFlight.control;this.pitchTarget.x=Distribution.pitchControl(this.pitchTarget.x,control),this.pitchTarget.y=Distribution.pitchControl(this.pitchTarget.y,control),"right"==this.pitcher["throws"]&&(this.pitchInFlight.breakDirection[0]*=-1);var breakEffect=Distribution.breakEffect(this.pitchInFlight,this.pitchTarget.x,this.pitchTarget.y);this.pitchInFlight.x=breakEffect.x,this.pitchInFlight.y=breakEffect.y,this.log.notePitch(this.pitchInFlight,this.batter),this.stage="swing","none"==this.humanControl||"both"!=this.humanControl&&!this.humanBatting()?this.autoSwing(x,y,callback):callback()}},battersEye:{e:"",n:""},theSwing:function(x,y,callback){if("swing"==this.stage){this.swingResult={};var bonus=this.batter.eye.bonus||0,eye=this.batter.skill.offense.eye+6*(this.umpire.count.balls+this.umpire.count.strikes)+bonus;if(x>=0&&200>=x){this.batter.fatigue++,this.swingResult.x=x-this.pitchInFlight.x,this.swingResult.y=y-this.pitchInFlight.y,this.swingResult.angle=this.setBatAngle();var recalculation=Mathinator.getAngularOffset(this.swingResult,this.swingResult.angle),precision=Distribution.swing(eye);this.swingResult.x=Math.abs(recalculation.x)>20?recalculation.x*precision:recalculation.x,this.swingResult.y=-5+(recalculation.y<0?recalculation.y*precision:recalculation.y),this.swingResult.looking=!1,Math.abs(this.swingResult.x)<60&&Math.abs(this.swingResult.y)<35?(this.swingResult.contact=!0,this.swingResult=this.field.determineSwingContactResult(this.swingResult),this.debug.push(this.swingResult)):this.swingResult.contact=!1}else this.swingResult.strike=this.pitchInFlight.x>50&&this.pitchInFlight.x<150&&this.pitchInFlight.y>35&&this.pitchInFlight.y<165,this.batter.eye.bonus=Math.max(0,eye-1.5*Math.sqrt(Math.pow(this.batter.eye.x-this.pitchInFlight.x,2)+Math.pow(this.batter.eye.y-this.pitchInFlight.y,2))),this.swingResult.contact=!1,this.swingResult.looking=!0,this.batter.eye.x=this.pitchInFlight.x,this.batter.eye.y=this.pitchInFlight.y;this.log.noteSwing(this.swingResult),this.stage="pitch";var half=this.half;this.umpire.makeCall(),half!=this.half&&(callback=this.startOpponentPitching),"function"==typeof callback&&("none"==this.humanControl||"both"!=this.humanControl&&this.teams[this.humanControl]!=this.pitcher.team?this.autoPitch(callback):callback())}},setBatAngle:function(x,y){var giraffe=this,origin={x:"right"==giraffe.batter.bats?-10:210,y:160},swing={x:x?x:giraffe.pitchInFlight.x+this.swingResult.x,y:y?y:giraffe.pitchInFlight.y+this.swingResult.y};return Mathinator.battingAngle(origin,swing)},debugOut:function(){log("slugging",this.debug.filter(function(a){return 1==a.bases}).length,this.debug.filter(function(a){return 2==a.bases}).length,this.debug.filter(function(a){return 3==a.bases}).length,this.debug.filter(function(a){return 4==a.bases}).length),log("grounders",this.debug.filter(function(a){return!a.caught&&!a.foul&&a.flyAngle<-5}).length),log("grounders thrown out",this.debug.filter(function(a){return!a.caught&&!a.foul&&a.flyAngle<-5&&a.thrownOut}).length),log("weak fly hits (thrown out)",this.debug.filter(function(a){return!a.caught&&!a.foul&&a.flyAngle>0&&a.thrownOut}).length),log("good fly hits (not caught)",this.debug.filter(function(a){return!a.caught&&!a.foul&&a.flyAngle>0&&!a.thrownOut}).length);var PO={};this.debug.map(function(a){PO[a.fielder]||(PO[a.fielder]=0),!a.bases&&a.fielder&&PO[a.fielder]++}),log("fielding outs",PO);var hitters=this.teams.away.lineup.concat(this.teams.home.lineup),atBats=[];hitters.map(function(a){atBats=atBats.concat(a.atBats)});var LO=atBats.filter(function(ab){return"LO"==ab}).length;log("line outs",LO);var FO=atBats.filter(function(ab){return"FO"==ab}).length;log("fly outs",FO);var GO=atBats.filter(function(ab){return"GO"==ab}).length;log("groundouts",GO);var SO=atBats.filter(function(ab){return"SO"==ab}).length;log("strikeouts",SO),log("fouls",this.debug.filter(function(a){return a.foul}).length)},startOpponentPitching:null,pitchTarget:{x:100,y:100},pitchInFlight:{x:100,y:100,breakDirection:[0,0],name:"slider",velocity:50,"break":50,control:50},swingResult:{x:100,y:100,strike:!1,foul:!1,caught:!1,contact:!1,looking:!0,bases:0,fielder:"short",outs:0},pitchSelect:function(){},field:null,teams:{away:null,home:null},log:null,half:"top",inning:1,scoreboard:{away:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},home:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0}},tally:{away:{H:0,R:0,E:0},home:{H:0,R:0,E:0}}},exports.Game=Game;var Manager=function(team){this.init(team)};Manager.prototype={constructor:Manager,init:function(team){this.team=team},makeLineup:function(){var jerseyNumber=1;this.team.positions.pitcher=this.selectForSkill(this.team.bench,["pitching"]),this.team.positions.pitcher.position="pitcher",this.team.positions.pitcher.number=jerseyNumber++,this.team.positions.catcher=this.selectForSkill(this.team.bench,["defense","catching"],!0),this.team.positions.catcher.position="catcher",this.team.positions.catcher.number=jerseyNumber++,Iterator.each(this.team.bench,function(key,player){player.number=jerseyNumber++}),this.team.positions["short"]=this.selectForSkill(this.team.bench,["defense","fielding"],!0),this.team.positions["short"].position="short",this.team.positions.second=this.selectForSkill(this.team.bench,["defense","fielding"],!0),this.team.positions.second.position="second",this.team.positions.third=this.selectForSkill(this.team.bench,["defense","fielding"],!0),this.team.positions.third.position="third",this.team.positions.center=this.selectForSkill(this.team.bench,["defense","speed"]),this.team.positions.center.position="center",this.team.positions.left=this.selectForSkill(this.team.bench,["defense","speed"]),this.team.positions.left.position="left",this.team.positions.right=this.selectForSkill(this.team.bench,["defense","speed"]),this.team.positions.right.position="right",this.team.positions.first=this.selectForSkill(this.team.bench,["defense","fielding"]),this.team.positions.first.position="first",this.team.lineup[3]=this.selectForSkill(this.team.positions,["offense","power"]),this.team.lineup[3].order=3,this.team.lineup[2]=this.selectForSkill(this.team.positions,["offense","power"]),this.team.lineup[2].order=2,this.team.lineup[4]=this.selectForSkill(this.team.positions,["offense","power"]),this.team.lineup[4].order=4,this.team.lineup[0]=this.selectForSkill(this.team.positions,["offense","speed"]),this.team.lineup[0].order=0,this.team.lineup[1]=this.selectForSkill(this.team.positions,["offense","eye"]),this.team.lineup[1].order=1,this.team.lineup[5]=this.selectForSkill(this.team.positions,["offense","eye"]),this.team.lineup[5].order=5,this.team.lineup[6]=this.selectForSkill(this.team.positions,["offense","eye"]),this.team.lineup[6].order=6,this.team.lineup[7]=this.selectForSkill(this.team.positions,["offense","eye"]),this.team.lineup[7].order=7,this.team.lineup[8]=this.selectForSkill(this.team.positions,["offense","speed"]),this.team.lineup[8].order=8},selectForSkill:function(pool,skillset,mustBeRightHanded){if(mustBeRightHanded=!!mustBeRightHanded,this.team.bench.length||pool==this.team.positions){var selection=this.team.bench[0],rating=0,index=0;return Iterator.each(pool,function(key,player){for(var skills=skillset.slice(),cursor=player.skill,property=skills.shift();property;)cursor=cursor[property],property=skills.shift();player.order+1||!(cursor>=rating)||mustBeRightHanded&&"right"!=player["throws"]||(rating=cursor,selection=player,index=key)}),pool==this.team.bench&&(delete this.team.bench[index],this.team.bench=this.team.bench.filter(function(player){return player instanceof selection.constructor})),selection}return"no players available"}},exports.Manager=Manager;var Player=function(team){this.init(team);var IP,ER,GS,W,L,offense=this.skill.offense,defense=this.skill.defense,randBetween=function(a,b,skill){return offense[skill]&&(skill=offense[skill]),defense[skill]&&(skill=defense[skill]),isNaN(skill)&&(skill=50),skill=Math.sqrt(.05+.95*Math.random())*skill,Math.floor(skill/100*(b-a)+a)},gamesIntoSeason=this.team.game.gamesIntoSeason;this.skill.pitching>65&&(IP=(this.skill.pitching-65)*gamesIntoSeason/20,ER=IP/9*randBetween(800,215,this.skill.pitching)/100,IP>gamesIntoSeason?(GS=Math.floor(gamesIntoSeason/5),W=randBetween(.1*GS,.8*GS,this.skill.pitching/1.2),L=randBetween(GS-W,0,this.skill.pitching/3)):(GS=Math.floor(gamesIntoSeason/40),W=randBetween(0,.6*GS,this.skill.pitching),L=randBetween(GS-W,0,this.skill.pitching)));var pa=randBetween(3*gamesIntoSeason,5*gamesIntoSeason,"speed"),paRemaining=pa,bb=Math.floor(randBetween(0,18,"power")*paRemaining/100);paRemaining-=bb;var ab=paRemaining,so=Math.floor(randBetween(33,2,"eye")*paRemaining/100);paRemaining-=so;var h=Math.floor(randBetween(185,472,"eye")*paRemaining/1e3);paRemaining-=h;var doubles=randBetween(0,h/4,"power"),triples=randBetween(0,h/12,"speed"),hr=Math.max(0,randBetween(-h/20,h/5,"power")),r=randBetween(h/8,(h+bb)/3,"speed")+hr,rbi=randBetween(h/8,h/2,"power")+hr,hbp=randBetween(0,gamesIntoSeason/25),sac=randBetween(0,gamesIntoSeason/5,"eye"),chances=randBetween(0,10*gamesIntoSeason,"fielding"),E=randBetween(chances/10,0,"fielding"),PO=chances-E;this.stats={pitching:{pitches:0,GS:GS,W:W,L:L,strikes:0,K:0,getERA:function(){return 9*this.ER/Math.max(1/3,this.IP[0]+this.IP[1]/3)},ERA:null,ER:ER,H:0,HR:0,BB:0,IP:[IP,0]},batting:{getBA:function(){return this.h/Math.max(1,this.ab)},ba:null,getOBP:function(){return(this.h+this.bb+this.hbp)/(this.ab+this.bb+this.hbp+this.sac)},obp:null,getSLG:function(){return(this.h-this["2b"]-this["3b"]-this.hr+2*this["2b"]+3*this["3b"]+4*this.hr)/this.ab},slg:null,pa:pa,ab:ab,so:so,bb:bb,h:h,"2b":doubles,"3b":triples,hr:hr,r:r,rbi:rbi,hbp:hbp,sac:sac},fielding:{E:E,PO:PO,A:Math.floor(5*Math.random())+1}},this.stats.pitching.ERA=this.stats.pitching.getERA(),this.stats.batting.ba=this.stats.batting.getBA()};Player.prototype={constructor:Player,init:function(team,hero){this["throws"]=Math.random()>.86?"left":"right",this.bats=Math.random()>.75?"left":"right",this.team=team,this.skill={},this.eye={x:100,y:100},this.pitching={averaging:[]},this.number=0,this.randomizeSkills(hero||Math.random()>.9);var surnameKey=Math.floor(Math.random()*data.surnames.length),nameKey=Math.floor(Math.random()*data.names.length);this.name=data.surnames[surnameKey]+" "+data.names[nameKey];var jSurname=data.surnamesJ[surnameKey],jGivenName=data.namesJ[nameKey];1==jSurname.length&&jGivenName.length<=2&&(jSurname+="・"),1==jGivenName.length&&jSurname.indexOf("・")<0&&(jSurname+="・"),this.nameJ=jSurname+jGivenName,this.surname=data.surnames[surnameKey],this.surnameJ=data.surnamesJ[surnameKey],this.atBats=[]},atBatObjects:[],getAtBats:function(){return this.atBats.length>this.atBatObjects.length&&(this.atBatObjects=this.atBats.map(function(item){return new AtBat(item)})),this.atBatObjects},recordRBI:function(){this.atBats[this.atBats.length-1]+=AtBat.prototype.RBI_INDICATOR},recordInfieldHit:function(){this.atBats[this.atBats.length-1]+=AtBat.prototype.INFIELD_HIT_INDICATOR},getBaseRunningTime:function(){return Mathinator.baseRunningTime(this.skill.offense.speed)},randomizeSkills:function(hero){this.hero=hero;var giraffe=this,randValue=function(isPitching){var value=Math.floor(80*Math.pow(Math.random(),.75)+20*Math.random());return hero&&(value+=Math.floor((100-value)*Math.max(Math.random(),isPitching?0:.65))),isPitching&&giraffe.pitching.averaging.push(value),value};this.skill.offense={eye:randValue(),power:randValue(),speed:randValue()},this.skill.defense={catching:randValue(),fielding:randValue(),speed:randValue(),throwing:randValue()},this.pitching.averaging=[],this.pitching["4-seam"]={velocity:randValue(!0),"break":randValue(!0),control:randValue(!0)},this.pitching.slider={velocity:randValue(!0),"break":randValue(!0),control:randValue(!0)},Math.random()<.17&&(Math.random()>.6&&(this.pitching["2-seam"]={velocity:randValue(!0),"break":randValue(!0),control:randValue(!0)}),Math.random()<.18&&(this.pitching.fork={velocity:randValue(!0),"break":randValue(!0),control:randValue(!0)}),Math.random()>.77&&(this.pitching.cutter={velocity:randValue(!0),"break":randValue(!0),control:randValue(!0)}),Math.random()<.21&&(this.pitching.sinker={velocity:randValue(!0),"break":randValue(!0),control:randValue(!0)}),Math.random()<.4&&(this.pitching.curve={velocity:randValue(!0),"break":randValue(!0),control:randValue(!0)}),Math.random()<.9&&(this.pitching.change={velocity:randValue(!0),"break":randValue(!0),control:randValue(!0)})),this.skill.pitching=Math.floor(this.pitching.averaging.reduce(function(prev,current){return prev+current})/this.pitching.averaging.length+3*this.pitching.averaging.length),delete this.pitching.averaging},getSurname:function(){return"n"==mode?this.surnameJ:this.surname},getName:function(){return"n"==mode?this.nameJ:this.name},getUniformNumber:function(){return text("#")+this.number},getOrder:function(){return text([" 1st"," 2nd"," 3rd"," 4th"," 5th"," 6th","7th"," 8th"," 9th"][this.order])},eye:{},fatigue:0,name:"",number:0,position:"",atBats:[]},exports.Player=Player;var Team=function(game){this.init(game)};Team.prototype={constructor:Team,init:function(game){this.pickName(),this.lineup=[],this.bench=[],this.bullpen=[],this.positions={pitcher:null,catcher:null,first:null,second:null,"short":null,third:null,left:null,center:null,right:null},this.game=game;for(var j=0;20>j;j++)this.bench.push(new Player(this));20==this.bench.length&&(this.manager=new Manager(this),this.manager.makeLineup())},pickName:function(){var teamNameIndex=Math.floor(Math.random()*data.teamNames.length);this.name=data.teamNames[teamNameIndex],this.nameJ=data.teamNamesJ[teamNameIndex]},getName:function(){return"n"==mode?this.nameJ:this.name},lineup:[],positions:{},manager:null,bench:[],bullpen:[],nowBatting:0,expanded:"Player&"},exports.Team=Team;var Umpire=function(game){this.init(game)};Umpire.prototype={constructor:Umpire,init:function(game){this.game=game,this.playBall()},count:{strikes:0,balls:0,outs:0},playBall:function(){this.game.half="top",this.game.inning=1,this.game.batter=this.game.teams.away.lineup[0],this.game.batterRunner=this.game.teams.away.lineup[0],this.game.deck=this.game.teams.away.lineup[1],this.game.hole=this.game.teams.away.lineup[2],this.game.pitcher=this.game.teams.home.positions.pitcher;var n="一回のオモテ、"+this.game.teams.away.getName()+"の攻撃対"+this.game.teams.home.getName()+"、ピッチャーは"+this.game.teams.home.positions.pitcher.getName()+"。",e="Top 1, "+this.game.teams.away.name+" offense vs. "+this.game.teams.home.positions.pitcher.name+" starting for "+this.game.teams.home.name;this.game.log.note(e,n),this.game.log.noteBatter(this.game.batter)},makeCall:function(){this.says="";var result=this.game.swingResult,pitcher=this.game.pitcher,batter=this.game.batter;if(this.game.swingResult.fielder)var fielder=this.game.teams["top"==this.game.half?"home":"away"].positions[result.fielder];else fielder=null;if(this.game.batterRunner=this.game.batter,pitcher.stats.pitching.pitches++,result.looking)result.strike?(this.count.strikes++,pitcher.stats.pitching.strikes++):this.count.balls++;else if(result.contact){if(result.caught)batter.stats.batting.pa++,pitcher.stats.pitching.IP[1]++,result.sacrificeAdvances.length&&this.count.outs<2?(batter.stats.batting.sac++,this.game.batter.atBats.push(Log.prototype.SACRIFICE),this.advanceRunners(!1,null,result.sacrificeAdvances)):(batter.stats.batting.ab++,this.game.batter.atBats.push(result.flyAngle<10?Log.prototype.LINEOUT:Log.prototype.FLYOUT)),this.count.outs++,this.newBatter();else if(result.foul)this.count.strikes++,pitcher.stats.pitching.strikes++,this.count.strikes>2&&(this.count.strikes=2);else if(batter.stats.batting.pa++,batter.stats.batting.ab++,result.fieldersChoice&&this.count.outs<2?(result.bases=0,this.count.outs++,pitcher.stats.pitching.IP[1]++,this.game.batter.atBats.push(Log.prototype.FIELDERS_CHOICE),this.advanceRunners(!1,result.fieldersChoice),this.reachBase(),this.newBatter()):result.fieldersChoice&&(result.thrownOut=!0),result.thrownOut&&(this.count.outs++,pitcher.stats.pitching.IP[1]++,this.game.batter.atBats.push(Log.prototype.GROUNDOUT),this.count.outs<3&&this.advanceRunners(!1),this.newBatter()),result.hitByPitch&&batter.stats.batting.ab--,result.bases){result.error?result.bases>0&&(this.game.tally["top"==this.game.half?"home":"away"].E++,fielder.stats.fielding.E++):(this.game.tally["top"==this.game.half?"away":"home"][Log.prototype.SINGLE]++,pitcher.stats.pitching.H++);var bases=result.bases;switch(bases){case 0:this.game.batter.atBats.push(Log.prototype.GROUNDOUT);break;case 1:result.error?this.game.batter.atBats.push(Log.prototype.REACHED_ON_ERROR):(this.game.batter.atBats.push(Log.prototype.SINGLE),batter.stats.batting.h++);break;case 2:this.game.batter.atBats.push(Log.prototype.DOUBLE),batter.stats.batting.h++,batter.stats.batting["2b"]++;break;case 3:this.game.batter.atBats.push(Log.prototype.TRIPLE),batter.stats.batting.h++,batter.stats.batting["3b"]++;break;case 4:this.game.batter.atBats.push(Log.prototype.HOMERUN),pitcher.stats.pitching.HR++,batter.stats.batting.h++,batter.stats.batting.hr++}for(bases>0&&4>bases&&!result.error&&-1==["left","right","center"].indexOf(result.fielder)&&batter.recordInfieldHit(),bases>=1&&(this.advanceRunners(),this.reachBase(),bases-=1);bases>0;)bases-=1,this.advanceRunners();this.newBatter()}}else pitcher.stats.pitching.strikes++,this.count.strikes++;this.says=this.count.balls+" and "+this.count.strikes,this.count.strikes>2&&(batter.stats.batting.pa++,batter.stats.batting.ab++,batter.stats.batting.so++,pitcher.stats.pitching.K++,this.count.outs++,pitcher.stats.pitching.IP[1]++,this.count.balls=this.count.strikes=0,this.says="Strike three. Batter out.",batter.atBats.push(Log.prototype.STRIKEOUT),this.newBatter()),this.count.balls>3&&(batter.stats.batting.pa++,batter.stats.batting.bb++,pitcher.stats.pitching.BB++,this.says="Ball four.",this.count.balls=this.count.strikes=0,batter.atBats.push(Log.prototype.WALK),this.advanceRunners(!0).reachBase().newBatter()),this.count.outs>2&&(this.says="Three outs, change.",this.count.outs=this.count.balls=this.count.strikes=0,pitcher.stats.pitching.IP[0]++,pitcher.stats.pitching.IP[1]=0,this.changeSides())},reachBase:function(){return this.game.field.first=this.game.batter,this.game.field.first.fatigue+=2,this},advanceRunners:function(isWalk,fieldersChoice,sacrificeAdvances){isWalk=!!isWalk;var first=this.game.field.first,second=this.game.field.second,third=this.game.field.third,game=this.game;if(isWalk)first&&(second?third?(game.batter.recordRBI(),game.batter.stats.batting.rbi++,third.atBats.push(Log.prototype.RUN),third.stats.batting.r++,game.pitcher.stats.pitching.ER++,game.scoreboard["top"==game.half?"away":"home"][game.inning]++,game.tally["top"==game.half?"away":"home"].R++,game.field.third=second,game.field.second=first,first=null):(game.field.third=second,game.field.second=first,game.field.first=null):third?(game.field.second=first,game.field.first=null):(game.field.second=first,game.field.first=null));else{fieldersChoice&&(game.field[fieldersChoice]=null,first=this.game.field.first,second=this.game.field.second,third=this.game.field.third);var canAdvance=function(){return!0};sacrificeAdvances&&(canAdvance=function(position){return sacrificeAdvances.indexOf(position)>-1}),third instanceof Player&&canAdvance("third")&&(game.scoreboard["top"==game.half?"away":"home"][game.inning]++,game.tally["top"==game.half?"away":"home"].R++,game.batter!=third&&(game.batter.recordRBI(),third.atBats.push(Log.prototype.RUN)),game.batter.stats.batting.rbi++,third.stats.batting.r++,game.pitcher.stats.pitching.ER++),game.field.third=second&&canAdvance("first")?second:null,game.field.second=first&&canAdvance("first")?first:null,game.field.first=null}return this},newBatter:function(){this.game.log.pitchRecord={e:[],n:[]},this.count.balls=this.count.strikes=0,this.game.log.notePlateAppearanceResult(this.game);var team="bottom"==this.game.half?this.game.teams.home:this.game.teams.away;this.game.batter=team.lineup[(team.nowBatting+1)%9],this.game.deck=team.lineup[(team.nowBatting+2)%9],this.game.hole=team.lineup[(team.nowBatting+3)%9],team.nowBatting=(team.nowBatting+1)%9,this.count.outs<3&&this.game.log.noteBatter(this.game.batter)},changeSides:function(){this.game.swingResult={},this.game.swingResult.looking=!0,this.game.pitchInFlight.x=null,this.game.pitchInFlight.y=null,this.game.log.pitchRecord={e:[],n:[]};var offense,defense;if(this.game.field.first=null,this.game.field.second=null,this.game.field.third=null,"top"==this.game.half){if(9==this.game.inning&&this.game.tally.home.R>this.game.tally.away.R)return this.game.end();this.game.half="bottom"}else{if(this.game.inning+1>9)return this.game.end();this.game.inning++,this.game.half="top"}offense="top"==this.game.half?"away":"home",defense="top"==this.game.half?"home":"away";var n=this.game.inning+"回の"+("top"==this.game.half?"オモテ":"ウラ")+"、"+this.game.teams["top"==this.game.half?"away":"home"].getName()+"の攻撃。",e=("top"==this.game.half?"Top":"Bottom")+" "+this.game.inning;this.game.log.note(e,n);var team=this.game.teams[offense];this.game.batter=team.lineup[team.nowBatting],this.game.batterRunner=this.game.batter,this.game.deck=team.lineup[(team.nowBatting+1)%9],this.game.hole=team.lineup[(team.nowBatting+2)%9],this.game.pitcher=this.game.teams[defense].positions.pitcher,this.game.log.noteBatter(this.game.batter)},says:"Play ball!",game:null},exports.Umpire=Umpire;var Catcher=function(){this.init()};Catcher.prototype={init:function(){}};var Fielder=function(){this.init()};Fielder.prototype={init:function(){}};var Pitcher=function(){this.init()};Pitcher.prototype={init:function(){}};var Batter=function(){this.init()};Batter.prototype={init:function(){}};var Runner=function(){this.init()};Runner.prototype={init:function(){}},IndexController=function($scope){window.s=$scope,$scope.t=text,$scope.mode=function(setMode){return setMode&&(mode=setMode),mode},$scope.proceedToGame=function(quickMode,spectateCpu){Game.prototype.humanControl=spectateCpu?"none":"home",Game.prototype.quickMode=!!quickMode,$scope.y=new Game;var game=$scope.y;if(s2.y=game,bindMethods(),jQ(".blocking").remove(),"none"==game.humanControl&&game.quickMode){var n=0;do n++,game.simulateInput(function(callback){"function"==typeof callback&&callback()});while("end"!=game.stage&&500>n);log("sim ended"),game.debugOut()}else if("none"==game.humanControl)var scalar=game.quickMode?.05:1,auto=setInterval(function(){"end"==game.stage&&clearInterval(auto),game.simulatePitchAndSwing(function(callback){game.quickMode?void 0:$scope.$apply(),$scope.updateFlightPath(callback)})},scalar*(game.field.hasRunnersOn()?4e3:5500));"away"==game.humanControl&&game.simulateInput(function(callback){$scope.updateFlightPath(callback)}),"home"==game.humanControl};var bindMethods=function(){var game=$scope.y;$scope.holdUpTimeouts=[],$scope.expandScoreboard=!1;var animator=new Animator;$scope.updateFlightPath=animator.updateFlightPath.bind($scope);var bat=jQ(".target .swing.stance-indicator"),showBat=function(event){if(game.humanBatting()){var offset=jQ(".target").offset(),relativeOffset={x:event.pageX-offset.left,y:200-(event.pageY-offset.top)},angle=game.setBatAngle(relativeOffset.x,relativeOffset.y);bat.css({top:200-relativeOffset.y+"px",left:relativeOffset.x+"px",transform:"rotate("+angle+"deg)"}),relativeOffset.x>200||relativeOffset.x<0||relativeOffset.y>200||relativeOffset.y<0?bat.hide():bat.show()}},glove=jQ(".target .glove.stance-indicator"),showGlove=function(event){game.humanPitching()};$scope.selectPitch=function(pitchName){"pitch"==game.stage&&(game.pitchInFlight=jQ.extend({},game.pitcher.pitching[pitchName]),game.pitchInFlight.name=pitchName,game.swingResult.looking=!0)},$scope.allowInput=!0,$scope.holdUp=function(){jQ(".no-swing").click(),$scope.$apply()},game.startOpponentPitching=function(callback){$scope.updateFlightPath(callback)},$scope.indicate=function($event){if($scope.allowInput&&!game.pitcher.windingUp){game.humanPitching()&&($scope.allowInput=!1);var offset=jQ(".target").offset(),relativeOffset={x:$event.pageX-offset.left,y:200-($event.pageY-offset.top)};for(clearTimeout($scope.lastTimeout);$scope.holdUpTimeouts.length;)clearTimeout($scope.holdUpTimeouts.shift());game.receiveInput(relativeOffset.x,relativeOffset.y,function(callback){$scope.updateFlightPath(callback)})}},$scope.abbreviatePosition=function(position){return"e"==mode?{pitcher:"P",catcher:"C",first:"1B",second:"2B","short":"SS",third:"3B",left:"LF",center:"CF",right:"RF"}[position]:text.fielderShortName(position)},$scope.$watch("y.humanBatting()",function(){$scope.y.humanBatting()?jQ(".target").mousemove(showBat):(jQ(".target").unbind("mousemove",showBat),bat.hide())}),$scope.$watch("y.humanPitching()",function(){$scope.y.humanPitching()?jQ(".target").mousemove(showGlove):(jQ(".target").unbind("mousemove",showGlove),glove.hide())})}},ScoreboardDirective=function(){return{scope:{game:"=",text:"="},templateUrl:"js/internal/angular/views/directives/scoreboard.html?cache="+cacheKey,link:function(scope){window.s2=scope,scope.t=scope.text,scope.y=scope.game}}};var app=angular.module("YakyuuAikoukai",["directives"]);cacheKey=Math.floor(1500*Math.random()),angular.module("directives",[]).directive("scoreboard",ScoreboardDirective),angular.module("controllers",[]).controller("IndexController",IndexController);
//# sourceMappingURL=sourcemaps/application.js.map