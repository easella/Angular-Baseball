IndexController=function($scope){var text=Baseball.util.text,Game=Baseball.Game,Animator=Baseball.service.Animator;window.s=$scope,$scope.t=text,$scope.mode=function(setMode){return setMode&&(text.mode=setMode),text.mode},$scope.proceedToGame=function(quickMode,spectateCpu){Game.prototype.humanControl=spectateCpu?"none":"home",Game.prototype.quickMode=!!quickMode,$scope.y=new Game;var game=$scope.y;if(s2.y=game,bindMethods(),$(".blocking").remove(),"none"==game.humanControl&&game.quickMode){var n=0;do n++,game.simulateInput(function(callback){"function"==typeof callback&&callback()});while("end"!=game.stage&&500>n);log("sim ended"),game.debugOut()}else if("none"==game.humanControl)var scalar=game.quickMode?.05:1,auto=setInterval(function(){"end"==game.stage&&clearInterval(auto),game.simulatePitchAndSwing(function(callback){game.quickMode?void 0:$scope.$apply(),$scope.updateFlightPath(callback)})},scalar*(game.field.hasRunnersOn()?Animator.TIME_FROM_SET+2e3:Animator.TIME_FROM_WINDUP+2e3));"away"==game.humanControl&&game.simulateInput(function(callback){$scope.updateFlightPath(callback)}),"home"==game.humanControl};var bindMethods=function(){var game=$scope.y;$scope.holdUpTimeouts=[],$scope.expandScoreboard=!1;var animator=new Animator;$scope.updateFlightPath=animator.updateFlightPath.bind($scope);var bat=$(".target .swing.stance-indicator"),showBat=function(event){if(game.humanBatting()){var offset=$(".target").offset(),relativeOffset={x:event.pageX-offset.left,y:200-(event.pageY-offset.top)},angle=game.setBatAngle(relativeOffset.x,relativeOffset.y);bat.css({top:200-relativeOffset.y+"px",left:relativeOffset.x+"px",transform:"rotate("+angle+"deg) rotateY("+("left"==game.batter.bats?0:-0)+"deg)"}),relativeOffset.x>200||relativeOffset.x<0||relativeOffset.y>200||relativeOffset.y<0?bat.hide():bat.show()}},glove=$(".target .glove.stance-indicator"),showGlove=function(event){if(game.humanPitching()){var offset=$(".target").offset(),relativeOffset={x:event.pageX-offset.left,y:200-(event.pageY-offset.top)};glove.css({top:200-relativeOffset.y+"px",left:relativeOffset.x+"px"}),relativeOffset.x>200||relativeOffset.x<0||relativeOffset.y>200||relativeOffset.y<0?glove.hide():glove.show()}};$scope.selectPitch=function(pitchName){"pitch"==game.stage&&(game.pitchInFlight=$.extend({},game.pitcher.pitching[pitchName]),game.pitchInFlight.name=pitchName,game.swingResult.looking=!0)},$scope.allowInput=!0,$scope.holdUp=function(){$(".no-swing").click(),$scope.$apply()},game.startOpponentPitching=function(callback){$scope.updateFlightPath(callback)},$scope.indicate=function($event){if($scope.allowInput&&!game.pitcher.windingUp){game.humanPitching()&&($scope.allowInput=!1);var offset=$(".target").offset(),relativeOffset={x:$event.pageX-offset.left,y:200-($event.pageY-offset.top)};for(clearTimeout($scope.lastTimeout);$scope.holdUpTimeouts.length;)clearTimeout($scope.holdUpTimeouts.shift());game.receiveInput(relativeOffset.x,relativeOffset.y,function(callback){$scope.updateFlightPath(callback)})}},$scope.abbreviatePosition=function(position){return"e"==text.mode?{pitcher:"P",catcher:"C",first:"1B",second:"2B","short":"SS",third:"3B",left:"LF",center:"CF",right:"RF"}[position]:text.fielderShortName(position)},$scope.$watch("y.humanBatting()",function(){$scope.y.humanBatting()?$(".target").mousemove(showBat):($(".target").unbind("mousemove",showBat),bat.hide())}),$scope.$watch("y.humanPitching()",function(){$scope.y.humanPitching()?$(".target").mousemove(showGlove):($(".target").unbind("mousemove",showGlove),glove.hide())})}},ScoreboardDirective=function(){return{scope:{game:"=",text:"="},templateUrl:"public/html/views/directives/scoreboard.html?cache="+cacheKey,link:function(scope){window.s2=scope,scope.t=scope.text,scope.y=scope.game}}};var app=angular.module("YakyuuAikoukai",["directives"]);cacheKey=Math.floor(1500*Math.random()),angular.module("directives",[]).directive("scoreboard",ScoreboardDirective),angular.module("controllers",[]).controller("IndexController",IndexController);
//# sourceMappingURL=sourcemaps/application.min.js.map