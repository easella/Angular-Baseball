IndexController=function($scope,socket){var text=Baseball.util.text,Game=Baseball.Game,Animator=Baseball.service.Animator;if(window.s=$scope,$scope.t=text,$scope.mode=function(setMode){return setMode&&(text.mode=setMode,localStorage&&(localStorage.__$yakyuuaikoukai_text_mode=setMode)),text.mode},localStorage){var mode=localStorage.__$yakyuuaikoukai_text_mode;("e"===mode||"n"===mode)&&$scope.mode(mode)}$scope.teamJapan=function(){var provider=new Baseball.teams.Provider;provider.assignTeam($scope.y,"TeamJapan","away");var game=$scope.y;"top"===game.half?(game.batter=game.teams.away.lineup[game.batter.order],game.deck=game.teams.away.lineup[(game.batter.order+1)%9],game.hole=game.teams.away.lineup[(game.batter.order+2)%9]):game.pitcher=game.teams.away.positions.pitcher},$scope.sim=function(){$scope.proceedToGame(1,1)},$scope.seventh=function(){$scope.proceedToGame(7)},$scope.playball=function(){$scope.proceedToGame()},$scope.spectate=function(){$scope.proceedToGame(0,1)},$scope.proceedToGame=function(quickMode,spectateCpu){$scope.y=new Game;var game=$scope.y;game.humanControl=spectateCpu?"none":"home",game.quickMode=!!quickMode&&7!==quickMode;var field=window.location.hash?window.location.hash.slice(1):game.teams.home.name+Math.ceil(47*Math.random());if("undefined"!=typeof io&&(socket.game=game,$scope.socket=io("http://georgefu.info:64321",{reconnection:!1}),$scope.socketService=socket,socket.socket=$scope.socket,socket.start(field)),window.location.hash="#"+field,s2.y=game,bindMethods(),$(".blocking").remove(),"none"==game.humanControl&&game.quickMode){var n=0;Animator.console=!0,game.console=!0;do n++,game.simulateInput(function(callback){"function"==typeof callback&&callback()});while("end"!=game.stage&&500>n);Animator.console=game.console=!1,log("sim ended"),game.debugOut()}else if("none"==game.humanControl)var scalar=game.quickMode?.05:1,auto=setInterval(function(){"end"==game.stage&&clearInterval(auto),game.simulatePitchAndSwing(function(callback){game.quickMode?void 0:$scope.$apply(),$scope.updateFlightPath(callback)})},scalar*(game.field.hasRunnersOn()?Animator.TIME_FROM_SET+2e3:Animator.TIME_FROM_WINDUP+2e3));else if(7===quickMode&&void 0===spectateCpu){Animator.console=game.quickMode=game.console=!0;do game.simulateInput(function(callback){"function"==typeof callback&&callback()});while(game.inning<7);log("sim halted in 7th"),game.debugOut(),Animator.console=game.quickMode=game.console=!1,game.stage="pitch",game.half="top",game.humanControl="home"}if("away"==game.humanControl&&game.simulateInput(function(callback){$scope.updateFlightPath(callback)}),"home"==game.humanControl&&($scope.showMessage=!0),!quickMode||7===quickMode){game.timeOfDay.h="00";for(var delay=100,interval=150;delay<(game.startTime.h-game.timeOfDay.h)*interval;)setTimeout(function(){game.passMinutes(60),$scope.$apply()},delay),delay+=interval}};var bindMethods=function(){var game=$scope.y;$scope.holdUpTimeouts=[],$scope.expandScoreboard=!1,$scope.updateFlightPath=Animator.updateFlightPath.bind($scope);var bat=$(".target .swing.stance-indicator"),showBat=function(event){if(game.humanBatting()){var offset=$(".target").offset(),relativeOffset={x:event.pageX-offset.left,y:200-(event.pageY-offset.top)},angle=game.setBatAngle(relativeOffset.x,relativeOffset.y);bat.css({top:200-relativeOffset.y+"px",left:relativeOffset.x+"px",transform:"rotate("+angle+"deg) rotateY("+("left"==game.batter.bats?0:-0)+"deg)"}),relativeOffset.x>200||relativeOffset.x<0||relativeOffset.y>200||relativeOffset.y<0?bat.hide():bat.show()}},glove=$(".target .glove.stance-indicator"),showGlove=function(event){if(game.humanPitching()){var offset=$(".target").offset(),relativeOffset={x:event.pageX-offset.left,y:200-(event.pageY-offset.top)};glove.css({top:200-relativeOffset.y+"px",left:relativeOffset.x+"px"}),relativeOffset.x>200||relativeOffset.x<0||relativeOffset.y>200||relativeOffset.y<0?glove.hide():glove.show()}};$scope.clickLineup=function(player){if(player.team.sub){var sub=player.team.sub;return player.team.sub=null,sub.substitute(player)}player.team.expanded=player.team.expanded==player?null:player},$scope.selectSubstitute=function(player){("home"!==game.humanControl||player.team===game.teams.home)&&("away"!==game.humanControl||player.team===game.teams.away)&&(player.team.sub=player.team.sub===player?null:player)},$scope.selectPitch=function(pitchName){"pitch"==game.stage&&(game.pitchInFlight=$.extend({},game.pitcher.pitching[pitchName]),game.pitchInFlight.name=pitchName,game.swingResult.looking=!0)},$scope.allowInput=!0,$scope.holdUp=function(){$(".input-area").click(),$scope.$apply()},game.startOpponentPitching=function(callback){$scope.updateFlightPath(callback)},$scope.indicate=function($event){if($scope.allowInput&&!game.pitcher.windingUp){game.humanPitching()&&($scope.allowInput=!1);var offset=$(".target").offset(),relativeOffset={x:$event.pageX-offset.left,y:200-($event.pageY-offset.top)};for(clearTimeout($scope.lastTimeout);$scope.holdUpTimeouts.length;)clearTimeout($scope.holdUpTimeouts.shift());$scope.showMessage=!1,game.receiveInput(relativeOffset.x,relativeOffset.y,function(callback){$scope.updateFlightPath(callback)})}},$scope.abbreviatePosition=function(position){return"e"==text.mode?{pitcher:"P",catcher:"C",first:"1B",second:"2B","short":"SS",third:"3B",left:"LF",center:"CF",right:"RF"}[position]:text.fielderShortName(position)},$scope.$watch("y.humanBatting()",function(){$scope.y.humanBatting()?$(".input-area").mousemove(showBat):($(".input-area").unbind("mousemove",showBat),bat.hide())}),$scope.$watch("y.humanPitching()",function(){$scope.y.humanPitching()?$(".input-area").mousemove(showGlove):($(".input-area").unbind("mousemove",showGlove),glove.hide())});({left:$("aside.image-panel.left"),right:$("aside.image-panel.right")})}};var SocketService=function(){var game,socket,Service=function(){},NO_OPERATION=function(){},animator=Baseball.service.Animator;return Service.prototype={socket:{},game:{},connected:!1,start:function(key){game=this.game,socket=this.socket,game.opponentService=this,this.connected=socket.connected,this.on(),socket.emit("register",key),socket.on("connect_failed reconnect_failed",function(){console.log("connection unavailable")})},on:function(){var giraffe=this;socket.on("register",this.register),socket.on("connect reconnect",function(){giraffe.connected=!0}),socket.on("disconnect",function(){giraffe.connected=!1}),socket.on("pitch",function(pitch){game.thePitch(0,0,NO_OPERATION,pitch);var scope=window.s;animator.updateFlightPath.bind(scope)()}),socket.on("swing",function(swing){game.theSwing(0,0,NO_OPERATION,swing);var scope=window.s;animator.updateFlightPath.bind(scope)(function(){swing.contact&&animator.animateFieldingTrajectory(game)})}),socket.on("partner_disconnect",function(){console.log("The opponent has disconnected"),game.opponentConnected=!1;var scope=window.s;scope.$digest()}),socket.on("partner_connect",function(){game.opponentConnected=!0;var scope=window.s;scope.$digest()}),socket.on("opponent_taking_field",function(){console.log("A challenger has appeared! Sending game data."),socket.emit("game_data",game.toData())}),socket.on("game_data",function(data){game.fromData(data);var scope=window.s;scope.$apply()}),socket.on("field_in_use",function(){game.opponentConnected=!1})},off:function(){socket.on("register",NO_OPERATION)},register:function(data){console.log(data),"away"===data&&(game.humanControl="away"),socket.on("register",NO_OPERATION)},emitPitch:function(pitch){socket.emit("pitch",pitch)},emitSwing:function(swing){socket.emit("swing",swing)},swing:function(){},pitch:function(){}},new Service};BattersDirective=function(){return{templateUrl:"public/html/views/directives/batters.html?cache="+cacheKey,transclude:!0}},BatteryDirective=function(){return{templateUrl:"public/html/views/directives/battery.html?cache="+cacheKey,transclude:!0}},FieldDirective=function(){return{templateUrl:"public/html/views/directives/field.html?cache="+cacheKey,transclude:!0}},RatingBlockDirective=function(){return{scope:{rating:"="},transclude:!0,templateUrl:"public/html/views/directives/ratingBlock.html?cache="+cacheKey,link:function(scope){}}},ScoreboardDirective=function(){return{scope:{game:"=",text:"="},templateUrl:"public/html/views/directives/scoreboard.html?cache="+cacheKey,link:function(scope){window.s2=scope,scope.t=scope.text,scope.y=scope.game}}};var app=angular.module("YakyuuAikoukai",["directives"]).service("socket",SocketService).controller("IndexController",["$scope","socket",IndexController]);app.config(function($interpolateProvider){$interpolateProvider.startSymbol("{{"),$interpolateProvider.endSymbol("}}")}),cacheKey=Math.floor(1500*Math.random()),angular.module("directives",[]).directive("scoreboard",ScoreboardDirective).directive("batters",BattersDirective).directive("battery",BatteryDirective).directive("field",FieldDirective).directive("ratingBlock",RatingBlockDirective);
//# sourceMappingURL=sourcemaps/application.min.js.map